# TriHexÎ¦ Cursor Notifier
#
# Cursorã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå¿…è¦ãªIssueãŒä½œæˆã•ã‚ŒãŸã‚‰ã€
# ã—ã‚Šã‚…ã†ã«é€šçŸ¥ã‚’é€ã‚Šã¾ã™ã€‚
#
# ä½œæˆ: 2025-10-27
# æ‰¿èª: GPT-5ï¼ˆçµ±æ²»å°†è»ï¼‰

name: Cursor Notifier

on:
  issues:
    types: [opened, labeled]

permissions:
  issues: write

jobs:
  notify-cursor-action:
    if: contains(github.event.issue.labels.*.name, 'cursor-action-required')
    runs-on: ubuntu-latest
    steps:
      - name: Add notification comment
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            
            const comment = `## ğŸ”” Cursorã‚¢ã‚¯ã‚·ãƒ§ãƒ³é€šçŸ¥
            
@shiryu: ã“ã®ã‚¿ã‚¹ã‚¯ã¯Cursorã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå¿…è¦ã§ã™ã€‚
            
**Issue**: #${issue.number}
**ã‚¿ã‚¤ãƒˆãƒ«**: ${issue.title}
            
Cursorã«ä»¥ä¸‹ã‚’æŒ‡ç¤ºã—ã¦ãã ã•ã„ï¼š
            
1. ã“ã®Issueã®å†…å®¹ã‚’ç¢ºèª
2. å¿…è¦ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
3. å®Œäº†å¾Œã€ã“ã®Issueã«ã‚³ãƒ¡ãƒ³ãƒˆ
4. Issueã‚’ã‚¯ãƒ­ãƒ¼ã‚º
            
---
            
**é€šçŸ¥æ—¥æ™‚**: ${new Date().toISOString()}`;
            
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
              body: comment
            });
            
            console.log(`âœ… Added notification comment to issue #${issue.number}`);
      
      - name: Send webhook notification (optional)
        if: env.DISCORD_WEBHOOK_URL != ''
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          curl -X POST "$DISCORD_WEBHOOK_URL" \
            -H "Content-Type: application/json" \
            -d "{
              \"content\": \"ğŸ”” Cursorã‚¢ã‚¯ã‚·ãƒ§ãƒ³å¿…è¦: Issue #${{ github.event.issue.number }}\\n${{ github.event.issue.html_url }}\"
            }"

  notify-review-needed:
    if: |
      contains(github.event.issue.labels.*.name, 'needs-claude') ||
      contains(github.event.issue.labels.*.name, 'needs-gemini') ||
      contains(github.event.issue.labels.*.name, 'needs-grok') ||
      contains(github.event.issue.labels.*.name, 'needs-deepseek') ||
      contains(github.event.issue.labels.*.name, 'needs-gpt5')
    runs-on: ubuntu-latest
    steps:
      - name: Add review notification comment
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            const labels = issue.labels.map(l => l.name);
            
            const reviewers = [];
            if (labels.includes('needs-claude')) reviewers.push('Claude');
            if (labels.includes('needs-gemini')) reviewers.push('Gemini');
            if (labels.includes('needs-grok')) reviewers.push('Grok');
            if (labels.includes('needs-deepseek')) reviewers.push('DeepSeek');
            if (labels.includes('needs-gpt5')) reviewers.push('GPT-5');
            
            const comment = `## ğŸ“‹ ãƒ¬ãƒ“ãƒ¥ãƒ¼é€šçŸ¥
            
@shiryu: ã“ã®ã‚¿ã‚¹ã‚¯ã¯ä»¥ä¸‹ã®AIã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒå¿…è¦ã§ã™ï¼š
            
${reviewers.map(r => `- **${r}**`).join('\n')}
            
Issueã®æœ¬æ–‡ã«ã€å„AIã¸ã®é€ä»˜ç”¨ãƒ†ã‚­ã‚¹ãƒˆãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚
ã‚³ãƒ”ãƒ¼ã—ã¦é€ä»˜ã—ã¦ãã ã•ã„ã€‚
            
---
            
**é€šçŸ¥æ—¥æ™‚**: ${new Date().toISOString()}`;
            
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
              body: comment
            });
            
            console.log(`âœ… Added review notification to issue #${issue.number}`);

