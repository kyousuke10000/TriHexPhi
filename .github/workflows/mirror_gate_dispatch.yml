name: Mirror Gate (dispatch test)
on:
  workflow_dispatch:
    inputs:
      dry_run:
        description: 'Dry run (true/false)'
        required: false
        default: 'true'
jobs:
  mirror:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v4
      
      - name: Debug check files
        run: |
          echo "=== Checking directory structure ==="
          ls -la | head -20
          echo ""
          echo "=== Checking 99_SYSTEM ==="
          ls -la 99_SYSTEM/ 2>/dev/null | head -10 || echo "99_SYSTEM not found"
          echo ""
          echo "=== Checking 00_RYUDO ==="
          ls -la 00_RYUDO/ 2>/dev/null | head -10 || echo "00_RYUDO not found"
          echo ""
          echo "=== Checking 70_AI_CHRONICLE ==="
          ls -la 70_AI_CHRONICLE/ 2>/dev/null | head -10 || echo "70_AI_CHRONICLE not found"
      
      - name: Build mirror tree
        run: |
          mkdir -p mirror
          rsync -av --prune-empty-dirs \
            --include="99_SYSTEM/" \
            --include="99_SYSTEM/Proofs/**" \
            --include="00_RYUDO/" \
            --include="00_RYUDO/Council/" \
            --include="00_RYUDO/Council/Records/**" \
            --include="70_AI_CHRONICLE/**" \
            --include="README.md" \
            --include="docs/" \
            --include="docs/index.md" \
            --exclude="*" \
            ./ mirror/
          echo "=== Files copied to mirror ==="
          find mirror -type f | head -30 || echo "No files found"
      
      - name: Dry-run listing
        run: |
          echo "---- DRY RUN ----"
          find mirror -type f | sort || true
          echo "---- END ----"
