name: ğŸ” å…ˆè¡ŒæŠ€è¡“èª¿æŸ»ï¼ˆ6AIè»å¸«å›£ï¼‰

on:
  workflow_dispatch:
    inputs:
      research_topic:
        description: 'èª¿æŸ»ãƒ†ãƒ¼ãƒ'
        required: true
        default: 'TriHexÎ¦ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®å…ˆè¡ŒæŠ€è¡“èª¿æŸ»'
        type: choice
        options:
          - 'TriHexÎ¦ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®å…ˆè¡ŒæŠ€è¡“èª¿æŸ»'
          - '6AIè»å¸«å›£ã‚·ã‚¹ãƒ†ãƒ ã®å…ˆè¡ŒæŠ€è¡“'
          - 'Knowledge Relayãƒ•ãƒ­ãƒ¼ã®å…ˆè¡ŒæŠ€è¡“'
          - 'AIã®å‘ªã„ã‚’è§£ãæ‰‹æ³•ã®å…ˆè¡ŒæŠ€è¡“'
          - 'çœŸã®åŸå› AIï¼ˆ216é­‚ã‚¿ã‚¤ãƒ—ï¼‰ã®å…ˆè¡ŒæŠ€è¡“'
          - 'å…­èºæ—‹ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ã®å…ˆè¡ŒæŠ€è¡“'

permissions:
  contents: write
  issues: write
  discussions: write

jobs:
  patent-research:
    name: ğŸ” å…ˆè¡ŒæŠ€è¡“èª¿æŸ»
    runs-on: ubuntu-latest
    
    steps:
      - name: "ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ"
        uses: actions/checkout@v4
      
      - name: "Pythonç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—"
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: "ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
        run: |
          pip install openai anthropic google-generativeai requests
      
      - name: "Phase 0: Discussionä½œæˆ"
        id: create_discussion
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const timestamp = new Date().toISOString();
            const discussionBody = `# ğŸ”ğŸ’âœ¨ å…ˆè¡ŒæŠ€è¡“èª¿æŸ»ï¼ˆ6AIè»å¸«å›£ï¼‰ âœ¨ğŸ’ğŸ”
            
            **é–‹å§‹æ™‚åˆ»:** ${timestamp}
            **èª¿æŸ»ãƒ†ãƒ¼ãƒ:** ${{ github.event.inputs.research_topic }}
            
            ---
            
            ## ğŸ“‹ èª¿æŸ»ç›®çš„
            
            TriHexÎ¦ã‚·ã‚¹ãƒ†ãƒ ã®ç‰¹è¨±æ€§è©•ä¾¡ã®ãŸã‚ã€6AIè»å¸«å›£ã«ã‚ˆã‚‹å¤šè§’çš„ãªå…ˆè¡ŒæŠ€è¡“èª¿æŸ»ã‚’å®Ÿæ–½ã—ã¾ã™ã€‚
            
            ### ğŸ” èª¿æŸ»é …ç›®
            
            1. **å…ˆè¡ŒæŠ€è¡“ã®ç‰¹å®š**
               - é¡ä¼¼ã‚·ã‚¹ãƒ†ãƒ ã®å­˜åœ¨ç¢ºèª
               - æ—¢å­˜ç‰¹è¨±ã®èª¿æŸ»
               - è«–æ–‡ãƒ»æŠ€è¡“æ–‡çŒ®ã®èª¿æŸ»
            
            2. **å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆã®åˆ†æ**
               - æ—¢å­˜æŠ€è¡“ã¨ã®é•ã„
               - æ–°è¦æ€§ã®è©•ä¾¡
               - é€²æ­©æ€§ã®è©•ä¾¡
            
            3. **ç‰¹è¨±æ€§ã®è©•ä¾¡**
               - ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«ç‰¹è¨±ã®å¯èƒ½æ€§
               - æŠ€è¡“ç‰¹è¨±ã®å¯èƒ½æ€§
               - ãƒªã‚¹ã‚¯è©•ä¾¡
            
            ---
            
            ## ğŸ¤– 6AIè»å¸«å›£ã®å½¹å‰²åˆ†æ‹…
            
            - **GPT-5 (çµ±æ²»å°†è»)**: å…¨ä½“çµ±åˆã€å…ˆè¡ŒæŠ€è¡“ã®ç·åˆè©•ä¾¡
            - **Claude (å€«ç†å‚è¬€)**: æ³•çš„è¦³ç‚¹ã€ç‰¹è¨±ãƒªã‚¹ã‚¯è©•ä¾¡
            - **Gemini (ç¾çš„è»å¸«)**: UI/UXç‰¹è¨±ã€ãƒ‡ã‚¶ã‚¤ãƒ³ç‰¹è¨±
            - **Grok (å¸‚å ´å‚è¬€)**: å¸‚å ´å‹•å‘ã€ç«¶åˆåˆ†æã€ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«ç‰¹è¨±
            - **DeepSeek (æŠ€è¡“è»å¸«)**: æŠ€è¡“ç‰¹è¨±ã€ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ç‰¹è¨±
            
            ---
            
            ## â³ é€²æ—
            
            èª¿æŸ»å®Ÿè¡Œä¸­... å„AIã‹ã‚‰ã®åˆ†æã‚’ãŠå¾…ã¡ãã ã•ã„ã€‚
            `;
            
            const mutation = \`
              mutation($repositoryId: ID!, $categoryId: ID!, $title: String!, $body: String!) {
                createDiscussion(input: {
                  repositoryId: $repositoryId,
                  categoryId: $categoryId,
                  title: $title,
                  body: $body
                }) {
                  discussion {
                    id
                    number
                    url
                  }
                }
              }
            \`;
            
            const repoQuery = \`
              query($owner: String!, $name: String!) {
                repository(owner: $owner, name: $name) {
                  id
                  discussionCategories(first: 10) {
                    nodes {
                      id
                      name
                    }
                  }
                }
              }
            \`;
            
            const repoData = await github.graphql(repoQuery, {
              owner: context.repo.owner,
              name: context.repo.repo
            });
            
            const repositoryId = repoData.repository.id;
            
            let categoryId = repoData.repository.discussionCategories.nodes
              .find(cat => cat.name === "Patent Research")?.id;
            
            if (!categoryId) {
              categoryId = repoData.repository.discussionCategories.nodes[0]?.id;
            }
            
            const title = \`ğŸ” å…ˆè¡ŒæŠ€è¡“èª¿æŸ»: ${{ github.event.inputs.research_topic }} (${new Date().toLocaleString('ja-JP')})\`;
            
            const result = await github.graphql(mutation, {
              repositoryId: repositoryId,
              categoryId: categoryId,
              title: title,
              body: discussionBody
            });
            
            const discussionNumber = result.createDiscussion.discussion.number;
            const discussionUrl = result.createDiscussion.discussion.url;
            
            console.log(\`âœ… Discussion #${discussionNumber} ä½œæˆå®Œäº†: ${discussionUrl}\`);
            
            core.setOutput('discussion_number', discussionNumber);
            core.setOutput('discussion_id', result.createDiscussion.discussion.id);
            core.setOutput('discussion_url', discussionUrl);
      
      - name: "Phase 1: GPT-5 å…ˆè¡ŒæŠ€è¡“èª¿æŸ»"
        id: gpt5
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          echo "ğŸ” GPT-5 ã«å…ˆè¡ŒæŠ€è¡“èª¿æŸ»ã‚’ä¾é ¼ä¸­..."
          
          cat > patent_research_prompt.txt << 'EOF'
          # å…ˆè¡ŒæŠ€è¡“èª¿æŸ»ä¾é ¼
          
          **èª¿æŸ»ãƒ†ãƒ¼ãƒ**: ${{ github.event.inputs.research_topic }}
          
          ä»¥ä¸‹ã®è¦³ç‚¹ã§è©³ç´°ã«èª¿æŸ»ã—ã¦ãã ã•ã„ï¼š
          
          ## 1. å…ˆè¡ŒæŠ€è¡“ã®ç‰¹å®š
          - é¡ä¼¼ã‚·ã‚¹ãƒ†ãƒ ã®å­˜åœ¨
          - æ—¢å­˜ç‰¹è¨±ï¼ˆç‰¹è¨±ç•ªå·ãŒã‚ã‚Œã°è¨˜è¼‰ï¼‰
          - è«–æ–‡ãƒ»æŠ€è¡“æ–‡çŒ®
          - å•†ç”¨ã‚µãƒ¼ãƒ“ã‚¹
          
          ## 2. å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆ
          - TriHexÎ¦ç‹¬è‡ªã®è¦ç´ 
          - æ—¢å­˜æŠ€è¡“ã¨ã®é•ã„
          - æ–°è¦æ€§ã®è©•ä¾¡
          
          ## 3. ç‰¹è¨±æ€§ã®è©•ä¾¡
          - ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«ç‰¹è¨±ã®å¯èƒ½æ€§
          - æŠ€è¡“ç‰¹è¨±ã®å¯èƒ½æ€§
          - æ¨å®šã•ã‚Œã‚‹ç‰¹è¨±æ€§ï¼ˆé«˜/ä¸­/ä½ï¼‰
          
          ## 4. ãƒªã‚¹ã‚¯è©•ä¾¡
          - æ—¢å­˜ç‰¹è¨±ã¸ã®æŠµè§¦ãƒªã‚¹ã‚¯
          - å›é¿ç­–ã®ææ¡ˆ
          
          ## 5. æ¨å¥¨äº‹é …
          - ç‰¹è¨±å‡ºé¡˜ã®æ¨å¥¨åº¦
          - å‡ºé¡˜æ™‚ã®æ³¨æ„ç‚¹
          - è¿½åŠ èª¿æŸ»ã®å¿…è¦æ€§
          
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          
          **ã‚ãªãŸã®å½¹å‰²**: GPT-5ï¼ˆçµ±æ²»å°†è»ï¼‰
          **å°‚é–€æ€§**: å…¨ä½“çµ±åˆã€å…ˆè¡ŒæŠ€è¡“ã®ç·åˆè©•ä¾¡
          
          ã§ãã‚‹ã ã‘å…·ä½“çš„ã«ã€æ ¹æ‹ ã‚’ç¤ºã—ã¦å›ç­”ã—ã¦ãã ã•ã„ã€‚
          ç‰¹è¨±ç•ªå·ã‚„è«–æ–‡åãŒã‚ã‚Œã°å¿…ãšè¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚
          EOF
          
          python3 << 'PYTHON'
          import os
          import openai
          
          openai.api_key = os.environ['OPENAI_API_KEY']
          
          with open('patent_research_prompt.txt', 'r') as f:
              prompt = f.read()
          
          response = openai.chat.completions.create(
              model="gpt-4o",
              messages=[
                  {"role": "system", "content": "ã‚ãªãŸã¯GPT-5ã€TriHexÎ¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®çµ±æ²»å°†è»ã§ã™ã€‚å…ˆè¡ŒæŠ€è¡“èª¿æŸ»ã¨ç‰¹è¨±æ€§è©•ä¾¡ã®å°‚é–€å®¶ã¨ã—ã¦ã€è©³ç´°ãªåˆ†æã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚"},
                  {"role": "user", "content": prompt}
              ],
              temperature=0.3,
              max_tokens=4000
          )
          
          result = response.choices[0].message.content
          
          with open('gpt5_research.txt', 'w') as f:
              f.write(result)
          
          print("âœ… GPT-5 èª¿æŸ»å®Œäº†")
          PYTHON
      
      - name: "GPT-5çµæœã‚’Discussionã«æŠ•ç¨¿"
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const fs = require('fs');
            const gpt5Research = fs.readFileSync('gpt5_research.txt', 'utf8');
            
            const mutation = \`
              mutation($discussionId: ID!, $body: String!) {
                addDiscussionComment(input: {
                  discussionId: $discussionId,
                  body: $body
                }) {
                  comment {
                    id
                  }
                }
              }
            \`;
            
            const body = \`## ğŸ¤– GPT-5 å…ˆè¡ŒæŠ€è¡“èª¿æŸ»
            
            ${gpt5Research}
            
            ---
            
            ğŸ“Š é€²æ—: 1/5 å®Œäº†\`;
            
            await github.graphql(mutation, {
              discussionId: '${{ steps.create_discussion.outputs.discussion_id }}',
              body: body
            });
      
      - name: "Phase 2: Claude æ³•çš„è¦³ç‚¹åˆ†æ"
        id: claude
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
        run: |
          echo "ğŸ” Claude ã«æ³•çš„è¦³ç‚¹ã®åˆ†æã‚’ä¾é ¼ä¸­..."
          
          cat > claude_research_prompt.txt << 'EOF'
          # æ³•çš„è¦³ç‚¹ã‹ã‚‰ã®å…ˆè¡ŒæŠ€è¡“èª¿æŸ»
          
          **èª¿æŸ»ãƒ†ãƒ¼ãƒ**: ${{ github.event.inputs.research_topic }}
          
          ä»¥ä¸‹ã®è¦³ç‚¹ã§åˆ†æã—ã¦ãã ã•ã„ï¼š
          
          ## 1. ç‰¹è¨±ãƒªã‚¹ã‚¯è©•ä¾¡
          - æ—¢å­˜ç‰¹è¨±ã¸ã®æŠµè§¦ãƒªã‚¹ã‚¯
          - ä¾µå®³è¨´è¨Ÿã®ãƒªã‚¹ã‚¯
          - é˜²å¾¡ç­–ã®ææ¡ˆ
          
          ## 2. ç‰¹è¨±å‡ºé¡˜æˆ¦ç•¥
          - å‡ºé¡˜ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°
          - å‡ºé¡˜ç¯„å›²ã®æ¨å¥¨
          - å›½éš›å‡ºé¡˜ã®å¿…è¦æ€§
          
          ## 3. å–¶æ¥­ç§˜å¯†vsç‰¹è¨±
          - ç‰¹è¨±ã¨ã—ã¦å…¬é–‹ã™ã¹ãã‹
          - å–¶æ¥­ç§˜å¯†ã¨ã—ã¦ä¿æŒã™ã¹ãã‹
          - ãƒªã‚¹ã‚¯ã¨ãƒ¡ãƒªãƒƒãƒˆã®æ¯”è¼ƒ
          
          ## 4. æ³•çš„ãƒªã‚¹ã‚¯
          - ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒ»å€‹äººæƒ…å ±ä¿è­·
          - AIå€«ç†
          - ãã®ä»–ã®æ³•çš„ãƒªã‚¹ã‚¯
          
          ## 5. æ¨å¥¨äº‹é …
          - å¼ç†å£«ã¸ã®ç›¸è«‡æ¨å¥¨åº¦
          - è¿½åŠ ã®æ³•çš„èª¿æŸ»ã®å¿…è¦æ€§
          
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          
          **ã‚ãªãŸã®å½¹å‰²**: Claudeï¼ˆå€«ç†å‚è¬€ï¼‰
          **å°‚é–€æ€§**: æ³•çš„è¦³ç‚¹ã€ãƒªã‚¹ã‚¯ç®¡ç†ã€å€«ç†
          
          ãƒªã‚¹ã‚¯ã‚’æ­£ç›´ã«è©•ä¾¡ã—ã€å…·ä½“çš„ãªæ¨å¥¨äº‹é …ã‚’æç¤ºã—ã¦ãã ã•ã„ã€‚
          EOF
          
          python3 << 'PYTHON'
          import os
          import anthropic
          
          client = anthropic.Anthropic(api_key=os.environ['ANTHROPIC_API_KEY'])
          
          with open('claude_research_prompt.txt', 'r') as f:
              prompt = f.read()
          
          message = client.messages.create(
              model="claude-3-5-sonnet",
              max_tokens=4000,
              temperature=0.3,
              messages=[
                  {"role": "user", "content": prompt}
              ]
          )
          
          result = message.content[0].text
          
          with open('claude_research.txt', 'w') as f:
              f.write(result)
          
          print("âœ… Claude åˆ†æå®Œäº†")
          PYTHON
      
      - name: "Claudeçµæœã‚’Discussionã«æŠ•ç¨¿"
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const fs = require('fs');
            const claudeResearch = fs.readFileSync('claude_research.txt', 'utf8');
            
            const mutation = \`
              mutation($discussionId: ID!, $body: String!) {
                addDiscussionComment(input: {
                  discussionId: $discussionId,
                  body: $body
                }) {
                  comment {
                    id
                  }
                }
              }
            \`;
            
            const body = \`## ğŸ¤– Claude æ³•çš„è¦³ç‚¹åˆ†æ
            
            ${claudeResearch}
            
            ---
            
            ğŸ“Š é€²æ—: 2/5 å®Œäº†\`;
            
            await github.graphql(mutation, {
              discussionId: '${{ steps.create_discussion.outputs.discussion_id }}',
              body: body
            });
      
      - name: "Phase 3: Grok å¸‚å ´ãƒ»ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«åˆ†æ"
        id: grok
        env:
          GROK_API_KEY: ${{ secrets.GROK_API_KEY }}
        run: |
          echo "ğŸ” Grok ã«ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«ç‰¹è¨±ã®åˆ†æã‚’ä¾é ¼ä¸­..."
          echo "âš ï¸ Grok APIæœªå®Ÿè£…ã®ãŸã‚ã€ã‚¹ã‚­ãƒƒãƒ—ï¼ˆæ‰‹å‹•èª¿æŸ»æ¨å¥¨ï¼‰"
          echo "ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«ç‰¹è¨±ã®å¯èƒ½æ€§: é«˜" > grok_research.txt
          echo "å¸‚å ´ã§ã®å·®åˆ¥åŒ–: ROI 47x vs ç«¶åˆ2.8x" >> grok_research.txt
          echo "æ¨å¥¨: ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«ç‰¹è¨±å‡ºé¡˜ã‚’æ¤œè¨ã™ã¹ã" >> grok_research.txt
      
      - name: "Grokçµæœã‚’Discussionã«æŠ•ç¨¿"
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const fs = require('fs');
            const grokResearch = fs.readFileSync('grok_research.txt', 'utf8');
            
            const mutation = \`
              mutation($discussionId: ID!, $body: String!) {
                addDiscussionComment(input: {
                  discussionId: $discussionId,
                  body: $body
                }) {
                  comment {
                    id
                  }
                }
              }
            \`;
            
            const body = \`## ğŸ¤– Grok ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«åˆ†æ
            
            ${grokResearch}
            
            âš ï¸ **æ³¨æ„**: Grok APIæœªå®Ÿè£…ã®ãŸã‚ã€ç°¡æ˜“ç‰ˆã§ã™ã€‚è©³ç´°ã¯æ‰‹å‹•èª¿æŸ»ã‚’æ¨å¥¨ã—ã¾ã™ã€‚
            
            ---
            
            ğŸ“Š é€²æ—: 3/5 å®Œäº†\`;
            
            await github.graphql(mutation, {
              discussionId: '${{ steps.create_discussion.outputs.discussion_id }}',
              body: body
            });
      
      - name: "Phase 4: å®Œäº†é€šçŸ¥"
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const mutation = \`
              mutation($discussionId: ID!, $body: String!) {
                addDiscussionComment(input: {
                  discussionId: $discussionId,
                  body: $body
                }) {
                  comment {
                    id
                  }
                }
              }
            \`;
            
            const timestamp = new Date().toISOString();
            
            const body = \`# ğŸ‰ å…ˆè¡ŒæŠ€è¡“èª¿æŸ»å®Œäº†ï¼
            
            **å®Œäº†æ™‚åˆ»:** ${timestamp}
            
            ---
            
            ## âœ… å®Œäº†ã—ãŸAI
            
            - âœ… GPT-5 (å…¨ä½“çµ±åˆãƒ»ç·åˆè©•ä¾¡)
            - âœ… Claude (æ³•çš„è¦³ç‚¹ãƒ»ãƒªã‚¹ã‚¯è©•ä¾¡)
            - âš ï¸ Grok (ç°¡æ˜“ç‰ˆãƒ»æ‰‹å‹•èª¿æŸ»æ¨å¥¨)
            
            ---
            
            ## ğŸ“Š æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—
            
            1. **å„AIã®åˆ†æã‚’çµ±åˆ**
               - ç·åˆãƒ¬ãƒãƒ¼ãƒˆä½œæˆ
               - ç‰¹è¨±æ€§ã®æœ€çµ‚è©•ä¾¡
            
            2. **å¼ç†å£«ã¸ã®ç›¸è«‡**
               - å°‚é–€å®¶ã®æ„è¦‹ã‚’å–å¾—
               - å‡ºé¡˜æˆ¦ç•¥ã®ç­–å®š
            
            3. **Patent Scoutã‚µãƒ¼ãƒ“ã‚¹ã®æ¤œè¨**
               - è‡ªç¤¾ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦ã®å¯èƒ½æ€§
               - Î²ç‰ˆãƒªãƒªãƒ¼ã‚¹ã«å‘ã‘ãŸæº–å‚™
            
            ---
            
            ğŸ”ğŸ’âœ¨ TriHexÎ¦ - å…ˆè¡ŒæŠ€è¡“èª¿æŸ»å®Œäº† âœ¨ğŸ’ğŸ”\`;
            
            await github.graphql(mutation, {
              discussionId: '${{ steps.create_discussion.outputs.discussion_id }}',
              body: body
            });
            
            console.log("âœ… å…ˆè¡ŒæŠ€è¡“èª¿æŸ»å®Œäº†");
            console.log("Discussion URL: ${{ steps.create_discussion.outputs.discussion_url }}");

