name: Auto Ops (PR→MirrorGate)

on:
  workflow_dispatch:
    inputs:
      pr:
        description: 'PR number (default: 34)'
        required: false
      dry_wait:
        description: 'poll interval sec (default: 10)'
        required: false
  schedule:
    - cron: '0 0 * * *'  # 毎日00:00 JST-?（UTCで調整してね）

jobs:
  auto:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      actions: write
      pull-requests: write
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with: { node-version: '20' }
      - name: Install gh
        uses: cli/cli@v2
      - name: Run
        env:
          REPO: ${{ github.repository }}
          PR: ${{ github.event.inputs.pr || '34' }}
          DRY_WAIT: ${{ github.event.inputs.dry_wait || '10' }}
        run: |
          node tools/ai_auto_ops.mjs
