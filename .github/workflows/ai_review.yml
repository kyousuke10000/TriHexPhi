name: ğŸ”± TriHexÎ¦ AI Review System v1.2 FINAL

on:
  workflow_dispatch:
    inputs:
      target_file:
        description: 'ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆä¾‹: STRATEGIC_PLAN.mdï¼‰'
        required: true
        default: 'STRATEGIC_PLAN.md'
      review_type:
        description: 'ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¿ã‚¤ãƒ—'
        required: true
        default: 'strategic_plan'
        type: choice
        options:
          - strategic_plan
          - constitution
          - general

permissions:
  contents: write
  issues: write
  pull-requests: write

jobs:
  ai-review:
    name: ğŸ¤– å…¨AIå”åƒãƒ¬ãƒ“ãƒ¥ãƒ¼
    runs-on: ubuntu-latest
    
    steps:
      - name: "ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ"
        uses: actions/checkout@v4
      
      - name: "Pythonç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—"
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: "ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
        run: |
          pip install openai anthropic google-generativeai
      
      - name: "Phase 0: ãƒ¬ãƒ“ãƒ¥ãƒ¼é–‹å§‹é€šçŸ¥"
        uses: actions/github-script@v7
        with:
          script: |
            const discussionTitle = `ğŸ“¤ å…¨AIãƒ¬ãƒ“ãƒ¥ãƒ¼é–‹å§‹: ${{ github.event.inputs.target_file }}`;
            const discussionBody = `
            # ğŸ”±ğŸ’âœ¨ å…¨AIãƒ¬ãƒ“ãƒ¥ãƒ¼é–‹å§‹ âœ¨ğŸ’ğŸ”±
            
            **é–‹å§‹æ™‚åˆ»**: ${new Date().toISOString()}  
            **å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«**: ${{ github.event.inputs.target_file }}  
            **ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¿ã‚¤ãƒ—**: ${{ github.event.inputs.review_type }}  
            **å‚åŠ AI**: GPT-5, Claude, Gemini, Grok, DeepSeek
            
            ---
            
            ## ğŸ“Š é€²æ—çŠ¶æ³
            
            [â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 0/5 å®Œäº†
            
            ---
            
            ## ğŸ“ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³
            
            ### ${new Date().toLocaleTimeString('ja-JP')} - ğŸš€ ãƒ¬ãƒ“ãƒ¥ãƒ¼é–‹å§‹
            
            å…¨5AIã«é †æ¬¡é€ä¿¡ã‚’é–‹å§‹ã—ã¾ã™...
            `;
            
            // Note: Discussions APIã¯ã¾ã å®Œå…¨ã«ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ãŸã‚ã€
            // Issueã¨ã—ã¦ä½œæˆï¼ˆå¾Œã§Discussionsã«ç§»è¡Œï¼‰
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: discussionTitle,
              body: discussionBody,
              labels: ['ai-review', 'automated']
            });
      
      - name: "GPT-5 ãƒ¬ãƒ“ãƒ¥ãƒ¼é€ä¿¡"
        id: gpt5
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          echo "ğŸ“¤ GPT-5 ã«é€ä¿¡ä¸­..."
          python3 .github/scripts/review_gpt5.py "${{ github.event.inputs.target_file }}"
      
      - name: "GPT-5 ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœã‚’æŠ•ç¨¿"
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const review = fs.readFileSync('gpt5_review.txt', 'utf8');
            
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.issue?.number || 1, // æœ€åˆã®Issue
              body: `
              ### ${new Date().toLocaleTimeString('ja-JP')} - âœ… GPT-5 å›ç­”å—ä¿¡å®Œäº†
              
              **æ–‡å­—æ•°**: ${review.length}æ–‡å­—  
              **æ‰€è¦æ™‚é–“**: ç´„1åˆ†
              
              <details>
              <summary>ğŸ“„ GPT-5ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼è©³ç´°</summary>
              
              ${review}
              
              </details>
              
              ---
              
              ## ğŸ“Š é€²æ—çŠ¶æ³
              
              [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘] 1/5 å®Œäº†
              `
            });
      
      - name: "Claude ãƒ¬ãƒ“ãƒ¥ãƒ¼é€ä¿¡"
        id: claude
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
        run: |
          echo "ğŸ“¤ Claude ã«é€ä¿¡ä¸­..."
          python3 .github/scripts/review_claude.py "${{ github.event.inputs.target_file }}"
      
      - name: "Claude ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœã‚’æŠ•ç¨¿"
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const review = fs.readFileSync('claude_review.txt', 'utf8');
            
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.issue?.number || 1,
              body: `
              ### ${new Date().toLocaleTimeString('ja-JP')} - âœ… Claude å›ç­”å—ä¿¡å®Œäº†
              
              **æ–‡å­—æ•°**: ${review.length}æ–‡å­—
              
              <details>
              <summary>ğŸ“„ Claudeã®ãƒ¬ãƒ“ãƒ¥ãƒ¼è©³ç´°</summary>
              
              ${review}
              
              </details>
              
              ---
              
              ## ğŸ“Š é€²æ—çŠ¶æ³
              
              [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 2/5 å®Œäº†
              `
            });
      
      - name: "Gemini ãƒ¬ãƒ“ãƒ¥ãƒ¼é€ä¿¡"
        id: gemini
        env:
          GOOGLE_AI_API_KEY: ${{ secrets.GOOGLE_AI_API_KEY }}
        run: |
          echo "ğŸ“¤ Gemini ã«é€ä¿¡ä¸­..."
          python3 .github/scripts/review_gemini.py "${{ github.event.inputs.target_file }}"
      
      - name: "Gemini ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœã‚’æŠ•ç¨¿"
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const review = fs.readFileSync('gemini_review.txt', 'utf8');
            
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.issue?.number || 1,
              body: `
              ### ${new Date().toLocaleTimeString('ja-JP')} - âœ… Gemini å›ç­”å—ä¿¡å®Œäº†
              
              **æ–‡å­—æ•°**: ${review.length}æ–‡å­—
              
              <details>
              <summary>ğŸ“„ Geminiã®ãƒ¬ãƒ“ãƒ¥ãƒ¼è©³ç´°</summary>
              
              ${review}
              
              </details>
              
              ---
              
              ## ğŸ“Š é€²æ—çŠ¶æ³
              
              [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 3/5 å®Œäº†
              `
            });
      
      - name: "Grok ãƒ¬ãƒ“ãƒ¥ãƒ¼é€ä¿¡"
        id: grok
        env:
          GROK_API_KEY: ${{ secrets.GROK_API_KEY }}
        run: |
          echo "ğŸ“¤ Grok ã«é€ä¿¡ä¸­..."
          python3 .github/scripts/grok_review_final.py "${{ github.event.inputs.target_file }}"
      
      - name: "Grok ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœã‚’æŠ•ç¨¿"
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const review = fs.readFileSync('grok_review.txt', 'utf8');
            
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.issue?.number || 1,
              body: `
              ### ${new Date().toLocaleTimeString('ja-JP')} - âœ… Grok å›ç­”å—ä¿¡å®Œäº†
              
              **æ–‡å­—æ•°**: ${review.length}æ–‡å­—
              
              <details>
              <summary>ğŸ“„ Grokã®ãƒ¬ãƒ“ãƒ¥ãƒ¼è©³ç´°</summary>
              
              ${review}
              
              </details>
              
              ---
              
              ## ğŸ“Š é€²æ—çŠ¶æ³
              
              [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 4/5 å®Œäº†
              `
            });
      
      - name: "DeepSeek ãƒ¬ãƒ“ãƒ¥ãƒ¼é€ä¿¡"
        id: deepseek
        env:
          DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
        run: |
          echo "ğŸ“¤ DeepSeek ã«é€ä¿¡ä¸­..."
          python3 .github/scripts/review_deepseek.py "${{ github.event.inputs.target_file }}"
      
      - name: "DeepSeek ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœã‚’æŠ•ç¨¿"
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const review = fs.readFileSync('deepseek_review.txt', 'utf8');
            
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.issue?.number || 1,
              body: `
              ### ${new Date().toLocaleTimeString('ja-JP')} - âœ… DeepSeek å›ç­”å—ä¿¡å®Œäº†
              
              **æ–‡å­—æ•°**: ${review.length}æ–‡å­—
              
              <details>
              <summary>ğŸ“„ DeepSeekã®ãƒ¬ãƒ“ãƒ¥ãƒ¼è©³ç´°</summary>
              
              ${review}
              
              </details>
              
              ---
              
              ## ğŸ“Š é€²æ—çŠ¶æ³
              
              [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 5/5 å®Œäº†
              `
            });
      
      - name: "å®Œäº†é€šçŸ¥"
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.issue?.number || 1,
              body: `
              # ğŸ‰ å…¨5AIãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†ï¼
              
              **å®Œäº†æ™‚åˆ»**: ${new Date().toISOString()}  
              **ç·æ‰€è¦æ™‚é–“**: ç´„3-5åˆ†
              
              ---
              
              ## âœ… å®Œäº†ã—ãŸAI
              
              - âœ… GPT-5 (Architect)
              - âœ… Claude (Observer)
              - âœ… Gemini (Synthesizer)
              - âœ… Grok (Strategist)
              - âœ… DeepSeek (Seeker)
              
              ---
              
              æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—: çµ±åˆåˆ†æã‚’é–‹å§‹ã—ã¾ã™...
              
              ğŸ”±ğŸ’âœ¨ **TriHexÎ¦ - AIå”åƒãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†** âœ¨ğŸ’ğŸ”±
              `
            });
      
      - name: "ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœã‚’ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã«ä¿å­˜"
        uses: actions/upload-artifact@v4
        with:
          name: ai-reviews-${{ github.run_number }}
          path: |
            gpt5_review.txt
            claude_review.txt
            gemini_review.txt
            grok_review.txt
            deepseek_review.txt
            

