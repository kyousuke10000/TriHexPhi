name: ğŸ”± TriHexÎ¦ AI Review System v1.1

on:
  workflow_dispatch:
    inputs:
      target_file:
        description: 'ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆä¾‹: STRATEGIC_PLAN.mdï¼‰'
        required: true
        default: 'STRATEGIC_PLAN.md'
      review_type:
        description: 'ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¿ã‚¤ãƒ—'
        required: true
        default: 'strategic_plan'
        type: choice
        options:
          - strategic_plan
          - constitution
          - general

permissions:
  contents: write
  issues: write
  pull-requests: write

jobs:
  ai-review:
    name: ğŸ¤– å…¨AIå”åƒãƒ¬ãƒ“ãƒ¥ãƒ¼
    runs-on: ubuntu-latest
    
    steps:
      - name: "ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ"
        uses: actions/checkout@v4
      
      - name: "Pythonç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—"
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: "ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
        run: |
          pip install openai anthropic google-generativeai
      
      - name: "Phase 0: ãƒ¬ãƒ“ãƒ¥ãƒ¼é–‹å§‹é€šçŸ¥"
        uses: actions/github-script@v7
        with:
          script: |
            const discussionTitle = `ğŸ“¤ å…¨AIãƒ¬ãƒ“ãƒ¥ãƒ¼é–‹å§‹: ${{ github.event.inputs.target_file }}`;
            const discussionBody = `
            # ğŸ”±ğŸ’âœ¨ å…¨AIãƒ¬ãƒ“ãƒ¥ãƒ¼é–‹å§‹ âœ¨ğŸ’ğŸ”±
            
            **é–‹å§‹æ™‚åˆ»**: ${new Date().toISOString()}  
            **å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«**: ${{ github.event.inputs.target_file }}  
            **ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¿ã‚¤ãƒ—**: ${{ github.event.inputs.review_type }}  
            **å‚åŠ AI**: GPT-5, Claude, Gemini, Grok, DeepSeek
            
            ---
            
            ## ğŸ“Š é€²æ—çŠ¶æ³
            
            [â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 0/5 å®Œäº†
            
            ---
            
            ## ğŸ“ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³
            
            ### ${new Date().toLocaleTimeString('ja-JP')} - ğŸš€ ãƒ¬ãƒ“ãƒ¥ãƒ¼é–‹å§‹
            
            å…¨5AIã«é †æ¬¡é€ä¿¡ã‚’é–‹å§‹ã—ã¾ã™...
            `;
            
            // Note: Discussions APIã¯ã¾ã å®Œå…¨ã«ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ãŸã‚ã€
            // Issueã¨ã—ã¦ä½œæˆï¼ˆå¾Œã§Discussionsã«ç§»è¡Œï¼‰
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: discussionTitle,
              body: discussionBody,
              labels: ['ai-review', 'automated']
            });
      
      - name: "GPT-5 ãƒ¬ãƒ“ãƒ¥ãƒ¼é€ä¿¡"
        id: gpt5
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          echo "ğŸ“¤ GPT-5 ã«é€ä¿¡ä¸­..."
          python3 << 'EOF'
          import os
          from openai import OpenAI
          
          client = OpenAI(api_key=os.environ['OPENAI_API_KEY'])
          
          with open('${{ github.event.inputs.target_file }}', 'r') as f:
              content = f.read()
          
          prompt = f"""
          ã€GPT-5ã¸ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¾é ¼ã€‘
          
          ã‚ãªãŸã®å°‚é–€æ€§ï¼ˆã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ï¼‰ã‹ã‚‰ã€
          ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ãã ã•ã„ã€‚
          
          ãƒ•ã‚¡ã‚¤ãƒ«: ${{ github.event.inputs.target_file }}
          
          ---
          
          {content}
          
          ---
          
          ãƒ¬ãƒ“ãƒ¥ãƒ¼å†…å®¹:
          1. ç·åˆè©•ä¾¡ï¼ˆ10ç‚¹æº€ç‚¹ï¼‰
          2. å¼·ã¿ã¨å¼±ã¿
          3. æ”¹å–„ææ¡ˆï¼ˆ3-5å€‹ï¼‰
          """
          
          response = client.chat.completions.create(
              model="gpt-4-turbo-preview",
              messages=[{"role": "user", "content": prompt}],
              max_tokens=4000,
              temperature=0.7
          )
          
          result = response.choices[0].message.content
          print(f"âœ… GPT-5ã‹ã‚‰å›ç­”å—ä¿¡ï¼ˆ{len(result)}æ–‡å­—ï¼‰")
          
          # çµæœã‚’ä¿å­˜
          with open('gpt5_review.txt', 'w') as f:
              f.write(result)
          EOF
          echo "response<<EOF" >> $GITHUB_OUTPUT
          cat gpt5_review.txt >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT
      
      - name: "GPT-5 ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœã‚’æŠ•ç¨¿"
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const review = fs.readFileSync('gpt5_review.txt', 'utf8');
            
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.issue?.number || 1, // æœ€åˆã®Issue
              body: `
              ### ${new Date().toLocaleTimeString('ja-JP')} - âœ… GPT-5 å›ç­”å—ä¿¡å®Œäº†
              
              **æ–‡å­—æ•°**: ${review.length}æ–‡å­—  
              **æ‰€è¦æ™‚é–“**: ç´„1åˆ†
              
              <details>
              <summary>ğŸ“„ GPT-5ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼è©³ç´°</summary>
              
              ${review}
              
              </details>
              
              ---
              
              ## ğŸ“Š é€²æ—çŠ¶æ³
              
              [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘] 1/5 å®Œäº†
              `
            });
      
      - name: "Claude ãƒ¬ãƒ“ãƒ¥ãƒ¼é€ä¿¡"
        id: claude
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
        run: |
          echo "ğŸ“¤ Claude ã«é€ä¿¡ä¸­..."
          python3 << 'EOF'
          import os
          import anthropic
          
          client = anthropic.Anthropic(api_key=os.environ['ANTHROPIC_API_KEY'])
          
          with open('${{ github.event.inputs.target_file }}', 'r') as f:
              content = f.read()
          
          prompt = f"""
          ã€Claudeã¸ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¾é ¼ã€‘
          
          ã‚ãªãŸã®å°‚é–€æ€§ï¼ˆå€«ç†ã€ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã€ãƒªã‚¹ã‚¯ç®¡ç†ï¼‰ã‹ã‚‰ã€
          ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ãã ã•ã„ã€‚
          
          ãƒ•ã‚¡ã‚¤ãƒ«: ${{ github.event.inputs.target_file }}
          
          ---
          
          {content}
          
          ---
          
          ãƒ¬ãƒ“ãƒ¥ãƒ¼å†…å®¹:
          1. ç·åˆè©•ä¾¡ï¼ˆ10ç‚¹æº€ç‚¹ï¼‰
          2. ãƒªã‚¹ã‚¯åˆ†æ
          3. å€«ç†çš„èª²é¡Œ
          4. æ”¹å–„ææ¡ˆï¼ˆ3-5å€‹ï¼‰
          """
          
          response = client.messages.create(
              model="claude-3-5-sonnet-20241022",
              max_tokens=4000,
              messages=[{"role": "user", "content": prompt}]
          )
          
          result = response.content[0].text
          print(f"âœ… Claudeã‹ã‚‰å›ç­”å—ä¿¡ï¼ˆ{len(result)}æ–‡å­—ï¼‰")
          
          with open('claude_review.txt', 'w') as f:
              f.write(result)
          EOF
      
      - name: "Claude ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœã‚’æŠ•ç¨¿"
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const review = fs.readFileSync('claude_review.txt', 'utf8');
            
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.issue?.number || 1,
              body: `
              ### ${new Date().toLocaleTimeString('ja-JP')} - âœ… Claude å›ç­”å—ä¿¡å®Œäº†
              
              **æ–‡å­—æ•°**: ${review.length}æ–‡å­—
              
              <details>
              <summary>ğŸ“„ Claudeã®ãƒ¬ãƒ“ãƒ¥ãƒ¼è©³ç´°</summary>
              
              ${review}
              
              </details>
              
              ---
              
              ## ğŸ“Š é€²æ—çŠ¶æ³
              
              [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 2/5 å®Œäº†
              `
            });
      
      - name: "Gemini ãƒ¬ãƒ“ãƒ¥ãƒ¼é€ä¿¡"
        id: gemini
        env:
          GOOGLE_AI_API_KEY: ${{ secrets.GOOGLE_AI_API_KEY }}
        run: |
          echo "ğŸ“¤ Gemini ã«é€ä¿¡ä¸­..."
          python3 << 'EOF'
          import os
          import google.generativeai as genai
          
          genai.configure(api_key=os.environ['GOOGLE_AI_API_KEY'])
          model = genai.GenerativeModel('gemini-2.0-flash-exp')
          
          with open('${{ github.event.inputs.target_file }}', 'r') as f:
              content = f.read()
          
          prompt = f"""
          ã€Geminiã¸ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¾é ¼ã€‘
          
          ã‚ãªãŸã®å°‚é–€æ€§ï¼ˆUI/UXã€å¯è¦–åŒ–ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ï¼‰ã‹ã‚‰ã€
          ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ãã ã•ã„ã€‚
          
          ãƒ•ã‚¡ã‚¤ãƒ«: ${{ github.event.inputs.target_file }}
          
          ---
          
          {content}
          
          ---
          
          ãƒ¬ãƒ“ãƒ¥ãƒ¼å†…å®¹:
          1. ç·åˆè©•ä¾¡ï¼ˆ10ç‚¹æº€ç‚¹ï¼‰
          2. UI/UXè¦–ç‚¹ã§ã®åˆ†æ
          3. å¯è¦–åŒ–ã®ææ¡ˆ
          4. æ”¹å–„ææ¡ˆï¼ˆ3-5å€‹ï¼‰
          """
          
          response = model.generate_content(
              prompt,
              generation_config=genai.types.GenerationConfig(
                  temperature=0.7,
                  max_output_tokens=4000,
              )
          )
          
          result = response.text
          print(f"âœ… Geminiã‹ã‚‰å›ç­”å—ä¿¡ï¼ˆ{len(result)}æ–‡å­—ï¼‰")
          
          with open('gemini_review.txt', 'w') as f:
              f.write(result)
          EOF
      
      - name: "Gemini ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœã‚’æŠ•ç¨¿"
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const review = fs.readFileSync('gemini_review.txt', 'utf8');
            
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.issue?.number || 1,
              body: `
              ### ${new Date().toLocaleTimeString('ja-JP')} - âœ… Gemini å›ç­”å—ä¿¡å®Œäº†
              
              **æ–‡å­—æ•°**: ${review.length}æ–‡å­—
              
              <details>
              <summary>ğŸ“„ Geminiã®ãƒ¬ãƒ“ãƒ¥ãƒ¼è©³ç´°</summary>
              
              ${review}
              
              </details>
              
              ---
              
              ## ğŸ“Š é€²æ—çŠ¶æ³
              
              [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 3/5 å®Œäº†
              `
            });
      
      - name: "Grok ãƒ¬ãƒ“ãƒ¥ãƒ¼é€ä¿¡"
        id: grok
        env:
          GROK_API_KEY: ${{ secrets.GROK_API_KEY }}
        run: |
          echo "ğŸ“¤ Grok ã«é€ä¿¡ä¸­..."
          python3 << 'EOF'
          import os
          from openai import OpenAI
          
          client = OpenAI(
              api_key=os.environ['GROK_API_KEY'],
              base_url="https://api.x.ai/v1"
          )
          
          with open('${{ github.event.inputs.target_file }}', 'r') as f:
              content = f.read()
          
          prompt = f"""
          ã€Grokã¸ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¾é ¼ã€‘
          
          ã‚ãªãŸã®å°‚é–€æ€§ï¼ˆå¸‚å ´åˆ†æã€ãƒãƒã‚¿ã‚¤ã‚ºã€GTMæˆ¦ç•¥ï¼‰ã‹ã‚‰ã€
          ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ãã ã•ã„ã€‚
          
          ãƒ•ã‚¡ã‚¤ãƒ«: ${{ github.event.inputs.target_file }}
          
          ---
          
          {content}
          
          ---
          
          ãƒ¬ãƒ“ãƒ¥ãƒ¼å†…å®¹:
          1. ç·åˆè©•ä¾¡ï¼ˆ10ç‚¹æº€ç‚¹ï¼‰
          2. å¸‚å ´æ€§åˆ†æ
          3. ãƒãƒã‚¿ã‚¤ã‚ºæˆ¦ç•¥ã®è©•ä¾¡
          4. æ”¹å–„ææ¡ˆï¼ˆ3-5å€‹ï¼‰
          """
          
          response = client.chat.completions.create(
              model="grok-4",
              messages=[{"role": "user", "content": prompt}],
              max_tokens=4000,
              temperature=0.7
          )
          
          result = response.choices[0].message.content
          print(f"âœ… Grokã‹ã‚‰å›ç­”å—ä¿¡ï¼ˆ{len(result)}æ–‡å­—ï¼‰")
          
          with open('grok_review.txt', 'w') as f:
              f.write(result)
          EOF
      
      - name: "Grok ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœã‚’æŠ•ç¨¿"
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const review = fs.readFileSync('grok_review.txt', 'utf8');
            
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.issue?.number || 1,
              body: `
              ### ${new Date().toLocaleTimeString('ja-JP')} - âœ… Grok å›ç­”å—ä¿¡å®Œäº†
              
              **æ–‡å­—æ•°**: ${review.length}æ–‡å­—
              
              <details>
              <summary>ğŸ“„ Grokã®ãƒ¬ãƒ“ãƒ¥ãƒ¼è©³ç´°</summary>
              
              ${review}
              
              </details>
              
              ---
              
              ## ğŸ“Š é€²æ—çŠ¶æ³
              
              [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 4/5 å®Œäº†
              `
            });
      
      - name: "DeepSeek ãƒ¬ãƒ“ãƒ¥ãƒ¼é€ä¿¡"
        id: deepseek
        env:
          DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
        run: |
          echo "ğŸ“¤ DeepSeek ã«é€ä¿¡ä¸­..."
          python3 << 'EOF'
          import os
          from openai import OpenAI
          
          client = OpenAI(
              api_key=os.environ['DEEPSEEK_API_KEY'],
              base_url="https://api.deepseek.com/v1"
          )
          
          with open('${{ github.event.inputs.target_file }}', 'r') as f:
              content = f.read()
          
          prompt = f"""
          ã€DeepSeekã¸ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¾é ¼ã€‘
          
          ã‚ãªãŸã®å°‚é–€æ€§ï¼ˆæŠ€è¡“çš„æ·±æ˜ã‚Šã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã€æœ€é©åŒ–ï¼‰ã‹ã‚‰ã€
          ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ãã ã•ã„ã€‚
          
          ãƒ•ã‚¡ã‚¤ãƒ«: ${{ github.event.inputs.target_file }}
          
          ---
          
          {content}
          
          ---
          
          ãƒ¬ãƒ“ãƒ¥ãƒ¼å†…å®¹:
          1. ç·åˆè©•ä¾¡ï¼ˆ10ç‚¹æº€ç‚¹ï¼‰
          2. æŠ€è¡“çš„å®Œç’§æ€§ã®åˆ†æ
          3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®ææ¡ˆ
          4. æ”¹å–„ææ¡ˆï¼ˆ3-5å€‹ï¼‰
          """
          
          response = client.chat.completions.create(
              model="deepseek-chat",
              messages=[{"role": "user", "content": prompt}],
              max_tokens=4000,
              temperature=0.7
          )
          
          result = response.choices[0].message.content
          print(f"âœ… DeepSeekã‹ã‚‰å›ç­”å—ä¿¡ï¼ˆ{len(result)}æ–‡å­—ï¼‰")
          
          with open('deepseek_review.txt', 'w') as f:
              f.write(result)
          EOF
      
      - name: "DeepSeek ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœã‚’æŠ•ç¨¿"
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const review = fs.readFileSync('deepseek_review.txt', 'utf8');
            
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.issue?.number || 1,
              body: `
              ### ${new Date().toLocaleTimeString('ja-JP')} - âœ… DeepSeek å›ç­”å—ä¿¡å®Œäº†
              
              **æ–‡å­—æ•°**: ${review.length}æ–‡å­—
              
              <details>
              <summary>ğŸ“„ DeepSeekã®ãƒ¬ãƒ“ãƒ¥ãƒ¼è©³ç´°</summary>
              
              ${review}
              
              </details>
              
              ---
              
              ## ğŸ“Š é€²æ—çŠ¶æ³
              
              [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 5/5 å®Œäº†
              `
            });
      
      - name: "å®Œäº†é€šçŸ¥"
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.issue?.number || 1,
              body: `
              # ğŸ‰ å…¨5AIãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†ï¼
              
              **å®Œäº†æ™‚åˆ»**: ${new Date().toISOString()}  
              **ç·æ‰€è¦æ™‚é–“**: ç´„3-5åˆ†
              
              ---
              
              ## âœ… å®Œäº†ã—ãŸAI
              
              - âœ… GPT-5 (Architect)
              - âœ… Claude (Observer)
              - âœ… Gemini (Synthesizer)
              - âœ… Grok (Strategist)
              - âœ… DeepSeek (Seeker)
              
              ---
              
              æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—: çµ±åˆåˆ†æã‚’é–‹å§‹ã—ã¾ã™...
              
              ğŸ”±ğŸ’âœ¨ **TriHexÎ¦ - AIå”åƒãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†** âœ¨ğŸ’ğŸ”±
              `
            });
      
      - name: "ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœã‚’ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã«ä¿å­˜"
        uses: actions/upload-artifact@v4
        with:
          name: ai-reviews-${{ github.run_number }}
          path: |
            gpt5_review.txt
            claude_review.txt
            gemini_review.txt
            grok_review.txt
            deepseek_review.txt
            

