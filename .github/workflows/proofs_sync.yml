name: ðŸ“Š Proofs Auto-Sync

# TriHex Proofs/Docs Auto-Sync (LV1)
# Purpose: å¸¸æ™‚ã‚ªãƒ¼ãƒˆåŒæœŸï¼ˆ[skip ci]ã§ãƒ«ãƒ¼ãƒ—é˜²æ­¢ï¼‰

on:
  push:
    branches: [main, feature/**]
    paths:
      - '99_SYSTEM/Proofs/**'
      - 'docs/**'

permissions:
  contents: write

jobs:
  auto-sync:
    runs-on: ubuntu-latest
    
    concurrency:
      group: proofs-auto-sync
      cancel-in-progress: false
    
    # Skip if commit message contains [skip ci] or is from itself
    if: |
      !contains(github.event.head_commit.message, '[skip ci]') &&
      !startsWith(github.event.head_commit.message, 'ðŸ“Š Auto-sync:')
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Set Git user
        run: |
          git config user.name "TriHex Bot"
          git config user.email "bot@trihex.local"
      
      - name: Normalize and Validate
        run: |
          echo "=== Normalizing Proofs/Docs ==="
          
          # Run normalization tools if they exist
          node scripts/normalize-md.mjs 99_SYSTEM/Proofs docs 2>/dev/null || echo "Normalizer skipped"
          
          echo "âœ… Validation complete"
      
      - name: Commit if changes
        run: |
          git add 99_SYSTEM/Proofs docs 2>/dev/null || true
          
          if ! git diff --cached --quiet; then
            git commit -m "ðŸ“Š Auto-sync: Proofs/Docs normalization [skip ci]"
            git push
            echo "âœ… Auto-synced"
          else
            echo "â„¹ï¸ No changes to sync"
          fi
      
      - name: Summary
        if: always()
        run: |
          echo "## Proofs Auto-Sync Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Date:** $(date -u +'%Y-%m-%d %H:%M:%S UTC')" >> $GITHUB_STEP_SUMMARY
          echo "**Branch:** ${{ github.ref }}" >> $GITHUB_STEP_SUMMARY
          echo "**Commit:** ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
