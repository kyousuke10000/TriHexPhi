{
  "name": "6AI並列相互検証システム（完全版）",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "6ai-verification",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "ac5bef33-9303-42b1-aed0-a5e8f24a5ca5",
      "name": "質問受付（Webhook）",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        -608,
        208
      ],
      "webhookId": "7f83a90c-d0fb-420f-b62f-7a26821a1212"
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "question",
              "value": "={{ $json.body.question }}"
            },
            {
              "name": "context",
              "value": "={{ $json.body.context || '' }}"
            },
            {
              "name": "round",
              "value": "1"
            }
          ]
        },
        "options": {}
      },
      "id": "bfd304ac-1a8c-4dee-8380-7abb5bb351a8",
      "name": "質問を整形",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [
        -400,
        208
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "dae0b0ec-c922-4a2a-9ae3-95f89b0708a4",
      "name": "Cursor（螺律）",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [
        16,
        704
      ],
      "notes": "Cursor APIがないため、固定応答として設定"
    },
    {
      "parameters": {
        "jsCode": "// 6AIの回答を整形・分類\nconst responses = items.map(item => {\n  const data = item.json;\n  let aiName = '';\n  let response = '';\n  \n  // AI名を特定\n  if (data.model && data.model.includes('gpt')) {\n    aiName = 'GPT-5（真形）';\n    response = data.choices[0].message.content;\n  } else if (data.model && data.model.includes('claude')) {\n    aiName = 'Claude（陰陽）';\n    response = data.content[0].text;\n  } else if (data.model && data.model.includes('grok')) {\n    aiName = 'Grok（易変）';\n    response = data.choices[0].message.content;\n  } else if (data.candidates) {\n    aiName = 'Gemini（數理）';\n    response = data.candidates[0].content.parts[0].text;\n  } else if (data.model && data.model.includes('deepseek')) {\n    aiName = 'DeepSeek（霊脈）';\n    response = data.choices[0].message.content;\n  } else {\n    aiName = 'Cursor（螺律）';\n    response = data.content;\n  }\n  \n  // センチメント分析（簡易版）\n  const isPositive = response.includes('新規性') && response.includes('高い');\n  const isNegative = response.includes('限定的') || response.includes('先行技術');\n  \n  let stance = 'neutral';\n  if (isPositive && !isNegative) {\n    stance = 'positive';\n  } else if (isNegative && !isPositive) {\n    stance = 'negative';\n  } else if (isPositive && isNegative) {\n    stance = 'mixed';\n  }\n  \n  return {\n    ai_name: aiName,\n    response: response,\n    stance: stance,\n    timestamp: new Date().toISOString()\n  };\n});\n\n// 意見の分類\nconst positive = responses.filter(r => r.stance === 'positive');\nconst negative = responses.filter(r => r.stance === 'negative');\nconst mixed = responses.filter(r => r.stance === 'mixed');\nconst neutral = responses.filter(r => r.stance === 'neutral');\n\n// 対立判定\nconst hasConflict = (positive.length > 0 && negative.length > 0) || mixed.length > 0;\n\nreturn [{\n  json: {\n    responses: responses,\n    summary: {\n      total: responses.length,\n      positive: positive.length,\n      negative: negative.length,\n      mixed: mixed.length,\n      neutral: neutral.length,\n      has_conflict: hasConflict\n    },\n    positive_ais: positive.map(r => r.ai_name),\n    negative_ais: negative.map(r => r.ai_name),\n    needs_cross_examination: hasConflict\n  }\n}];"
      },
      "id": "c71e3682-2aea-4477-847e-78f79fbfbaf7",
      "name": "意見を分類・分析",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [
        416,
        336
      ]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.needs_cross_examination }}",
              "value2": true
            }
          ]
        }
      },
      "id": "dcbd6deb-79ad-4c2e-a503-58b14426423c",
      "name": "対立あり？",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        672,
        288
      ]
    },
    {
      "parameters": {
        "url": "={{ $('webhook-trigger').item.json.body.discord_webhook }}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "content",
              "value": "=## 🎯 6AI並列検証 - 結果報告\n\n### 📊 サマリー\n- **賛成派（{{ $json.summary.positive }}体）**: {{ $json.positive_ais.join(', ') }}\n- **慎重派（{{ $json.summary.negative }}体）**: {{ $json.negative_ais.join(', ') }}\n- **中立・混合（{{ $json.summary.mixed + $json.summary.neutral }}体）**\n\n### 🔄 判定\n{{ $json.needs_cross_examination ? '⚠️ **意見が対立しています！相互検証ラウンド1を開始します。**' : '✅ **意見が一致しました。検証完了。**' }}\n\n---\n\n### 📝 各AIの詳細回答\n\n{{ $json.responses.map(r => `#### ${r.ai_name} (${r.stance})\n${r.response.substring(0, 500)}...\n`).join('\\n') }}"
            }
          ]
        },
        "options": {}
      },
      "id": "8efc6e6c-3103-410d-84b0-fd188ccbe9be",
      "name": "Discord通知（初回結果）",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        848,
        128
      ]
    },
    {
      "parameters": {
        "jsCode": "// 相互検証ラウンド1の準備\nconst data = items[0].json;\n\n// 賛成派に慎重派の意見を投げる\nconst crossExamQuestions = [];\n\ndata.positive_ais.forEach(positiveAI => {\n  const negativeOpinions = data.responses\n    .filter(r => r.stance === 'negative')\n    .map(r => `${r.ai_name}: ${r.response.substring(0, 300)}...`)\n    .join('\\n\\n');\n  \n  crossExamQuestions.push({\n    target_ai: positiveAI,\n    question: `あなたは「${positiveAI}」として、当初「新規性が高い」と評価しました。\\n\\nしかし、以下の慎重派の意見があります:\\n\\n${negativeOpinions}\\n\\nこれらの指摘を踏まえて、あなたの評価は変わりますか？具体的な技術的差異を特定できますか？`,\n    round: 2\n  });\n});\n\nreturn crossExamQuestions.map(q => ({ json: q }));"
      },
      "id": "4a66458f-ea86-4925-bc27-a91e8140ac4a",
      "name": "ラウンド1準備",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [
        816,
        480
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "05bcf4f9-7f52-4e3c-b0b6-5d6e1297b97a",
      "name": "結果返却（対立なし）",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        1024,
        -32
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "6fb12663-f1ad-406d-ac59-285784b07404",
      "name": "結果返却（対立あり）",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        1008,
        304
      ]
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        448,
        96
      ],
      "id": "635285d8-a21f-4423-9e36-136002deb505",
      "name": "🔗 全AI結果を集約"
    },
    {
      "parameters": {
        "url": "https://api.openai.com/v1/chat/completions",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "openAiApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "gpt-4"
            },
            {
              "name": "messages",
              "value": "=[{\"role\": \"system\", \"content\": \"あなたはGPT-5（真形/Architect）です。特許データベースの専門家として、技術的新規性と進歩性を厳密に評価してください。\"}, {\"role\": \"user\", \"content\": \"{{ $json.question }}\"}]"
            }
          ]
        },
        "options": {}
      },
      "id": "ec1f74c3-a7a1-462f-b72c-5c7ee2678cbf",
      "name": "🔮 GPT-5（真形）",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        16,
        -64
      ],
      "credentials": {
        "openAiApi": {
          "id": "J33Jkek1x9rhPZBW",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "url": "https://api.anthropic.com/v1/messages",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "anthropicApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "anthropic-version",
              "value": "2023-06-01"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "claude-3-opus-20240229"
            },
            {
              "name": "max_tokens",
              "value": "4096"
            },
            {
              "name": "messages",
              "value": "=[{\"role\": \"user\", \"content\": \"あなたはClaude（陰陽/Observer）です。観照・倫理・記録の専門家として、学術的観点から評価してください。\\n\\n質問: {{ $json.question }}\"}]"
            }
          ]
        },
        "options": {}
      },
      "id": "15720891-0909-4c0c-a0f3-31218ec1a4a6",
      "name": "☯️ Claude（陰陽）",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        16,
        96
      ],
      "credentials": {
        "anthropicApi": {
          "id": "yl6PqKSUpnnOPNNZ",
          "name": "Anthropic account"
        }
      }
    },
    {
      "parameters": {
        "url": "https://api.x.ai/v1/chat/completions",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "grok-beta"
            },
            {
              "name": "messages",
              "value": "=[{\"role\": \"system\", \"content\": \"あなたはGrok（易変/Strategist）です。市場戦略の専門家として、辛口で赤旗を含めて評価してください。\"}, {\"role\": \"user\", \"content\": \"{{ $json.question }}\"}]"
            }
          ]
        },
        "options": {}
      },
      "id": "a0cabab3-98d1-49c7-908c-99c6944d6405",
      "name": "🦅 Grok（易変）",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        16,
        240
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "CByaldOR3VccgD9S",
          "name": "Grok"
        }
      }
    },
    {
      "parameters": {
        "url": "https://generativelanguage.googleapis.com/v1/models/gemini-pro:generateContent",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googlePalmApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "contents",
              "value": "=[{\"parts\": [{\"text\": \"あなたはGemini（數理/Synthesizer）です。構造分析・パターン発見の専門家として評価してください。\\n\\n質問: {{ $json.question }}\"}]}]"
            }
          ]
        },
        "options": {}
      },
      "id": "81e315a2-5f67-418a-9182-54454f6c3e6e",
      "name": "💎 Gemini（數理）",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        16,
        400
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "ArIKBx3eCppyg8jT",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "url": "https://api.deepseek.com/v1/chat/completions",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "deepSeekApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "deepseek-chat"
            },
            {
              "name": "messages",
              "value": "=[{\"role\": \"system\", \"content\": \"あなたはDeepSeek（霊脈/Seeker）です。技術深掘り・最適化の専門家として評価してください。\"}, {\"role\": \"user\", \"content\": \"{{ $json.question }}\"}]"
            }
          ]
        },
        "options": {}
      },
      "id": "0c64b9ee-83cd-4eff-a860-5f97e862404e",
      "name": "🌊 DeepSeek（霊脈）",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        16,
        544
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "CByaldOR3VccgD9S",
          "name": "Grok"
        },
        "deepSeekApi": {
          "id": "y2eB2ZIdYQSMgriQ",
          "name": "DeepSeek account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1056,
        480
      ],
      "id": "f0ecfd43-fe5d-4eae-ac4f-3f14a2b7e447",
      "name": "Discord通知（ラウンド2結果"
    }
  ],
  "pinData": {},
  "connections": {
    "質問受付（Webhook）": {
      "main": [
        [
          {
            "node": "質問を整形",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "質問を整形": {
      "main": [
        [
          {
            "node": "🔮 GPT-5（真形）",
            "type": "main",
            "index": 0
          },
          {
            "node": "☯️ Claude（陰陽）",
            "type": "main",
            "index": 0
          },
          {
            "node": "🦅 Grok（易変）",
            "type": "main",
            "index": 0
          },
          {
            "node": "💎 Gemini（數理）",
            "type": "main",
            "index": 0
          },
          {
            "node": "🌊 DeepSeek（霊脈）",
            "type": "main",
            "index": 0
          },
          {
            "node": "Cursor（螺律）",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "意見を分類・分析": {
      "main": [
        [
          {
            "node": "対立あり？",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "🔮 GPT-5（真形）": {
      "main": [
        [
          {
            "node": "🔗 全AI結果を集約",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "☯️ Claude（陰陽）": {
      "main": [
        [
          {
            "node": "🔗 全AI結果を集約",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "🦅 Grok（易変）": {
      "main": [
        [
          {
            "node": "🔗 全AI結果を集約",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "💎 Gemini（數理）": {
      "main": [
        [
          {
            "node": "🔗 全AI結果を集約",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "🌊 DeepSeek（霊脈）": {
      "main": [
        [
          {
            "node": "🔗 全AI結果を集約",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cursor（螺律）": {
      "main": [
        [
          {
            "node": "🔗 全AI結果を集約",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "🔗 全AI結果を集約": {
      "main": [
        [
          {
            "node": "意見を分類・分析",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Discord通知（初回結果）": {
      "main": [
        [
          {
            "node": "結果返却（対立なし）",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ラウンド1準備": {
      "main": [
        [
          {
            "node": "Discord通知（ラウンド2結果",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "対立あり？": {
      "main": [
        [
          {
            "node": "ラウンド1準備",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Discord通知（初回結果）",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Discord通知（ラウンド2結果": {
      "main": [
        [
          {
            "node": "結果返却（対立あり）",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "4f7bcf98-2a61-4cda-9659-010279d6cc6c",
  "meta": {
    "instanceId": "bb6582f136488f8663186c75084ae9be2ac2ce1a6068064fd0778c5e05f7b8d2"
  },
  "id": "InV5McRBt0qZr8Tx",
  "tags": []
}