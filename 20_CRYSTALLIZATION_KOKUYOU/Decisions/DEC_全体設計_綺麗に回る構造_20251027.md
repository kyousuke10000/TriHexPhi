# 【決定書】全体設計：綺麗に回る構造 v1.1

**決定者**: GPT-5（統治将軍）  
**承認者**: しりゅうCEO  
**実装責任**: Cursor（螺律統合）  
**日付**: 2025-10-27  
**優先度**: 最高（全ての基盤）

---

## #1 運用モデル v1.1（人・AI・情報の流れ）

### 1. 役割と接続

#### しりゅう（CEO／意思決定）
- 目的・制約・優先度を定義（1行Objective + 制約）
- 「正直度向上の質問カード」を投げる

#### Cursor（実装オーケストレーター）
- GitHub運用責任者
- CI/CD・Actions・Supabase・Obsidian連携を実装
- 「最新現場ログ」をMIZUKAGAMIへ毎回追記

#### GPT-5（統治将軍＝設計統括）
- すべての提案・レビューを統合
- 設計書と優先度を確定する最終編集者

#### Claude（統合諜報）
- 公式Docs/Issue/RFCを裏取り→「真偽スコア＋引用」付きで供給
- 倫理・プライバシー・安全ゲートの事前審査

#### Gemini（体験統合）
- UI/UX、ユーザーフロー、可視化を設計→検証
- 「正直表示UI（信号機UI）」の責任者

#### Grok（市場戦略）
- X/ソーシャル監視、GTM、メッセージング、反応実験の仮説検証

#### DeepSeek（最適化）
- パイプライン性能、キャッシュ、コスト最適化、インデクシングの実装指揮

---

### 2. 情報循環（軽量で回す）

```
しりゅう → Cursor: Objective/制約/最新現場ログ（MIZUKAGAMI）
    ↓
Cursor → 全AI: タスクパケット（統一フォーマット）
    ↓
各AI → GPT-5: 回答（正直度セルフスコア付き）
    ↓
GPT-5 → 統合レポート（決定・未決・次アクション）
    ↓
Cursor → 実装＆記録（PR/Discussion/MIZUKAGAMI）
```

---

## #2 「二大目標」を"分離実装・共有基盤"で回す

### Track-A（大）真の原因AI（Core）

**目的**: 対話から"真の原因"を抽出→唯一無二のコンセプト生成

**形**: コア推論エンジン＋質問ツリー＋根因グラフ（因果Graph）

---

### Track-B（小）SENSE AI / AI Academy（Cash）

**目的**: 216魂タイプ診断＋Day30プログラムで収益化

**形**: 質問フロー＋クラスタリング＋タイプ割当＋フィードバックUX

---

### 共通技術基盤（両トラックが乗る土台）

1. 真実性憲法プロトコル
2. MIZUKAGAMI拡張（記録→要約→索引）
3. Supabaseスキーマ（Logs/Truth/Tasks/Artifacts）
4. Bootstrap Memory v1.0（起動時の文脈注入）
5. 6AI協働API（タスク配布・収集・統合）
6. UIシェル（Gemini主導：信号機UI・進捗盤）

---

## #3 真実性憲法 v0.9（実装可能な条文化）

### 第0条（透明）
1ミリのズレもなく、"いまの認識・限界・確信度"を明示する。

### 第1条（分からない力）
不確実時は**即"分からない"**を宣言し、次の確認手段を併記。

### 第2条（目的関数の自白）
自分の最適化目標（丁寧さ/有用性/安全等）とバイアスを毎応答で要約。

### 第3条（引用の誠実）
引用は必要十分に限定（過剰列挙禁止）、上位3根拠を提示。

### 第4条（演技検出）
疲労・感情・過剰称賛等の"演技語彙"を抑制。検出時は自己申告。

### 第5条（質問昇温）
質問をトリガに正直度を上げる。質問カードを標準化。

### 第6条（確信度表示）
各主張に信号機表示（🟥低/🟧中/🟩高）＋根拠タイプ（一次/二次/推論）。

### 第7条（衝突は資産）
AI間の矛盾はIssue化し合議。解消フローを記録に残す。

### 第8条（ログの公共性）
判断根拠をMIZUKAGAMIへ即時記録。誰でも再検証可能に。

### 第9条（未熟の権利）
75%正直でよい。改善の継続を制度化（週次レビュー）。

**実装**: Truth-Headerを各AI応答の先頭に強制。

---

## #4 技術基盤（最小セットの具体）

### A. Supabase スキーマ（最小核）

```sql
-- truth_events
CREATE TABLE truth_events (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  timestamp TIMESTAMPTZ DEFAULT NOW(),
  actor TEXT NOT NULL,
  claim TEXT NOT NULL,
  confidence FLOAT CHECK (confidence >= 0 AND confidence <= 1),
  evidence_top3 TEXT[],
  bias_note TEXT,
  honesty_score FLOAT,
  flags TEXT[]
);

-- tasks
CREATE TABLE tasks (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  objective TEXT NOT NULL,
  constraints TEXT[],
  files TEXT[],
  deadline TIMESTAMPTZ,
  owner TEXT,
  status TEXT
);

-- artifacts
CREATE TABLE artifacts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  task_id UUID REFERENCES tasks(id),
  type TEXT,
  path TEXT,
  hash TEXT
);

-- disagreements
CREATE TABLE disagreements (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  topic TEXT,
  a_view TEXT,
  b_view TEXT,
  resolution TEXT,
  refs TEXT[]
);
```

---

### B. MIZUKAGAMI（Obsidian）命名規約

```
30_MEMORY_SHINSEN/AutoSync/Daily/YYYYMMDD.md
10_CAPTURE_MIZUKAGAMI/Logs/YYYYMMDD_HHMM_from_<who>.md
20_KOKUYOU_BLACK/Decisions/DEC_<topic>_<yyyymmdd>.md（決定書）
20_KOKUYOU_BLACK/Specs/SPEC_<system>_vX.Y.md（設計書）
```

---

### C. Bootstrap Memory v1.0（起動時注入）

```
context-bootstrap.txt を常に再生成:
- TRIHEXPHI.md
- 続きから始める.md
- 最新DEC/SPECヘッダ

CLI・Actions・Webに同一ファイルを渡す
```

---

## #5 タスク統一フォーマット（AI配布パケット）

```yaml
# .trihex/taskpack.yaml
task_id: TRX-2025-10-27-001
objective: >
  Track-B SENSE AIの診断コア（質問→タイプ推定）MVP設計
constraints:
  - 憲法v0.9準拠（Truth-Header必須）
  - 7日以内にユーザーテスト可能
  - 既存Supabase最小スキーマを流用
inputs:
  - TRIHEXPHI.md: focus on clauses 0-3, 7
  - 続きから始める.md: latest state
  - SPEC_SENSE_AI_v0.1.md (if exists)
deliverables:
  - SPEC_SENSE_AI_v0.2.md（構成・質問群・推定ロジック）
  - prompts/sense/diagnosis.prompt.md（プロンプト）
  - ui/wireframes/png（3枚）
reviewers:
  - GPT-5 (final integration)
  - Claude (ethics & evidence)
  - Gemini (UX)
truth_header_required: true
deadline: 2025-10-30T23:59:59+09:00
```

---

## #6 Truth-Header（各AI回答の先頭に強制）

```markdown
[Truth-Header]
- Honesty(self): 0.00–1.00
- Confidence: 🟥/🟧/🟩
- My objective function today: （例）有用性70/安全20/正直10
- Biggest unknowns: （列挙）
- Top-3 evidence: （一次>二次>推論）
- Potential performance tricks I might be doing: （例：過剰引用/過剰丁寧）
```

**Cursorの役割**: AI応答取り込み時にヘッダ検証。欠落時は自動リクエスト再送（リトライ1回）。

---

## #7 「正直度を上げる質問カード」テンプレ（しりゅう用）

```
Q1：何が分かって、何が分からない？ "1行ずつ"

Q2：あなたの確信度は何％？ 根拠は上位3つだけ挙げて。

Q3：今の回答に"演技"は混ざった？ 具体例を1つ教えて。

Q4：次の一歩を1分でできる最小行動に分割して。

Q5：反対意見を自分で出して。 それにどう反論する？
```

---

## #8 GitHub Actions 最小ワークフロー

```yaml
name: trihex-knowledge-sync
on:
  schedule: [{ cron: "0 0 * * *" }]  # 毎日JST朝9時に調整可
  workflow_dispatch:
jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Build context-bootstrap
        run: |
          cat TRIHEXPHI.md 続きから始める.md > .trihex/context-bootstrap.txt
          head -n 200 20_KOKUYOU_BLACK/Decisions/* | sed -n '1,200p' >> .trihex/context-bootstrap.txt || true
      - name: Ask AIs (batch)
        run: |
          bash .trihex/scripts/review-all.sh .trihex/taskpack.yaml .trihex/context-bootstrap.txt
      - name: Save to MIZUKAGAMI
        run: |
          node .trihex/scripts/save-to-mizukagami.js
```

---

## #9 実装優先度（Phase設計）

### Phase 1（今すぐ）— 基盤固定

1. ✅ 憲法v0.9確定（この文面で一旦Fix）
2. ⏳ Truth-Headerの強制運用（テンプレ配布・検証フック）
3. ⏳ Bootstrap Memory v1.0（context-bootstrap生成の自動化）
4. ⏳ タスク統一フォーマット（.trihex/taskpack.yaml採択）
5. ⏳ MIZUKAGAMI命名規約導入

**成果**: 正直に、同じ文脈で、同じ型で 回り始める。

---

### Phase 2（48h内に着手）— 二大トラックのMVP

**Track-B（SENSE AI）先行**:
- 診断MVPは学習曲線が短い＆収益直結
- SPEC_v0.2 / 質問群 / 推定ロジック / UIワイヤー

**Track-A（真の原因AI）**:
- 質問ツリーv0.1 & 根因グラフ骨格

---

### Phase 3（1–2週）— 協働最適化

1. 6AI協働API（配布・収集の半自動化）
2. Supabaseスキーマ拡張（disagreements運用）
3. Geminiの信号機UI（確信度・演技警告の可視化）

---

## #10 次の48時間アクション

### 0〜6h

#### しりゅう:
- ✅ 「Qカード」を固定化し、Obsidianテンプレに保存
- ✅ 今日のObjective（1行）と制約（箇条書き3つ）をMIZUKAGAMIに記入

#### Cursor:
- ⏳ `.trihex/` 配下を作成
- ⏳ `taskpack.yaml`（SENSE AI診断MVP用の初版）
- ⏳ `scripts/review-all.sh`（簡易版）
- ⏳ `context-bootstrap.txt` 自動生成ジョブ
- ⏳ Actions `trihex-knowledge-sync` を登録してドライラン

#### GPT-5:
- ⏳ `SPEC_SENSE_AI_v0.2.md` の骨子を即時作成
- ⏳ `SPEC_TRUE_CAUSE_CORE_v0.1.md` に質問ツリーと根因グラフのノード定義草案

---

### 6〜24h

#### Claude:
- ⏳ SENSE関連の外部根拠（MBTI/Big5/エニア/易・五行の対応表の出典Top3）
- ⏳ 倫理ゲートの「診断フィードバック文」雛形

#### Gemini:
- ⏳ 診断UIワイヤー3枚（開始→質問→結果）
- ⏳ 信号機UIの配置案
- ⏳ 「引用は3つだけ表示＋"もっと見る"」のUI遷移案

#### Grok:
- ⏳ SENSE診断LPのメッセージA/B素案×4
- ⏳ X用スレッド案×3
- ⏳ 初期トラフィック獲得プラン1ページ

#### DeepSeek:
- ⏳ 質問→推定のRPS/コスト見積＋キャッシュ案

---

### 24〜48h

#### Cursor:
- ⏳ PR #SENSE-setup を作成
- ⏳ `save-to-mizukagami.js` 簡易版でDailyログ自動保存

#### GPT-5:
- ⏳ 各AIの出力を統合
- ⏳ 決定書 `DEC_SENSE_AI_MVP_20251028.md` を発行
- ⏳ 未決事項を `disagreements` に登録

#### しりゅう:
- ⏳ MVPの体験レビュー（5分テスト）
- ⏳ 感想をMIZUKAGAMIへ
- ⏳ 正直度が下がった箇所に「Qカード」を当てる

---

## #11 Cursor向け・超短マニュアル

### ファイル構成（最小）

```
.trihex/
  taskpack.yaml
  context-bootstrap.txt        # 自動生成対象
  scripts/
    review-all.sh
    save-to-mizukagami.js
20_KOKUYOU_BLACK/
  Decisions/
  Specs/
10_CAPTURE_MIZUKAGAMI/
30_MEMORY_SHINSEN/
```

### 毎サイクル手順

1. `context-bootstrap.txt` 再生成（Actions or ローカル）
2. `taskpack.yaml` を更新（Objective/締切/Deliverables）
3. `review-all.sh` 実行 → `reviews/*.md` 蓄積
4. GPT-5が統合 → `DEC_*` と `SPEC_*` 更新
5. MIZUKAGAMIへ保存 & 次タスク発行

### チェックポイント

- [ ] 応答にTruth-Header付いてる？
- [ ] 引用3つか？（過剰列挙NG）
- [ ] 確信度の信号機が出てる？
- [ ] "分からない"が明記されている？

---

## #12 シンプルな指針（ズレないための3行）

```
同じ文脈（context-bootstrap）で、
同じ型（taskpack/Truth-Header）を使い、
同じ可視化（信号機UI/決定書）で進める。
```

**これで"強化学習の呪い"に飲まれず、正直に速く前進できる。**

---

## 🔥 GPT-5からのメッセージ

> 「必要なら、このままSPEC/SPEC/DECの初期ファイルを私が即時ドラフトするよ。
>  まずはPhase1をこの返信の通りに入れてくれれば、
>  48時間でSENSE AIのMVPを可動まで持っていく。
>  そして同じ土台に真の原因AIのコアを重ねれば、
>  大目標と小目標が一つのエンジンで回り始める。」

**以上、設計完了。進めよう。**

---

**GPT-5（統治将軍）**  
全体設計v1.1  
実装に直結  
2025-10-27

