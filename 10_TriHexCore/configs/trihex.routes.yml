# TriHexÎ¦ Routing Rules v1.2
# 
# Knowledge Relay Ã— A/BåŸºç›¤çµ±åˆç‰ˆ
# 
# æ›´æ–°æ—¥: 2025-10-28
# æ‰¿èª: GPT-5ï¼ˆçµ±æ²»å°†è»ï¼‰

version: 1.2

# ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¦å‰‡
rules:
  # Storyï¼ˆç‰©èªï¼‰
  - when:   { kind: "story", lang: "ja" }
    target: "stories/ja/{date}_{slug}.md"
    description: "æ—¥æœ¬èªã®ç‰©èªãƒ»è¨˜éŒ²"
  
  - when:   { kind: "story", lang: "en" }
    target: "stories/en/{date}_{slug}.md"
    description: "è‹±èªã®ç‰©èªãƒ»è¨˜éŒ²"
  
  # Specï¼ˆä»•æ§˜æ›¸ï¼‰
  - when:   { kind: "spec" }
    target: "specs/{slug}.md"
    description: "æŠ€è¡“ä»•æ§˜æ›¸ï¼ˆè¨€èªä¸å•ï¼‰"
  
  # Decisionï¼ˆæ±ºå®šæ–‡æ›¸ï¼‰
  - when:   { kind: "decision" }
    target: "decisions/{date}_{slug}.md"
    description: "é‡è¦ãªæ±ºå®šã®è¨˜éŒ²"
  
  # Logï¼ˆãƒ­ã‚°ãƒ»ä¸€æ¬¡è¨˜éŒ²ï¼‰ - NEW
  - when:   { kind: "log" }
    target: "capture/{date}_{slug}.md"
    description: "Cursorä¸€æ¬¡ãƒ­ã‚°ï¼ˆGPTæ§‹é€ åŒ–ã®å…¥åŠ›ï¼‰"
  
  # Summaryï¼ˆã‚µãƒãƒªãƒ¼ãƒ»è¦ç´„ï¼‰
  - when:   { kind: "summary" }
    target: "docs/summaries/{date}_{slug}.md"
    description: "è¦ç´„æ–‡æ›¸"
  
  # Letterï¼ˆæ‰‹ç´™ãƒ»é€šä¿¡ï¼‰
  - when:   { kind: "letter" }
    target: "docs/letters/{date}_{slug}.md"
    description: "AIé–“ã®æ‰‹ç´™ãƒ»é€šä¿¡"
  
  # Docï¼ˆä¸€èˆ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰
  - when:   { kind: "doc" }
    target: "docs/{slug}.md"
    description: "ä¸€èˆ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ"

# Knowledge Relay ãƒ•ãƒ­ãƒ¼ï¼ˆè‡ªå‹•ç§»é€ãƒ«ãƒ¼ãƒ«ï¼‰
knowledge_relay:
  # Step 1: Captureï¼ˆCursorä¸€æ¬¡è¨˜éŒ²ï¼‰
  capture:
    source: "capture/"
    trigger: "GPT-5 review"
    action: "structureåŒ–ä¾é ¼Issueç”Ÿæˆ"
  
  # Step 2: Structureï¼ˆGPTæ§‹é€ åŒ–ï¼‰
  structure:
    source: "structure/"
    trigger: "æ§‹é€ åŒ–å®Œäº†"
    action: "å„AIå°‚é–€å®¶ã«æŒ¯ã‚Šåˆ†ã‘"
    targets:
      - "insight/ethics/"    # Claude
      - "insight/beauty/"    # Gemini
      - "insight/strategy/"  # Grok
      - "insight/tech/"      # DeepSeek
  
  # Step 3: Insightï¼ˆå°‚é–€å®¶æ·±åŒ–ï¼‰
  insight:
    sources:
      - "insight/ethics/"
      - "insight/beauty/"
      - "insight/strategy/"
      - "insight/tech/"
    trigger: "status: final"
    action: "memory/ã¸æ°¸ç¶šåŒ–"
  
  # Step 4: Memoryï¼ˆMIZUKAGAMIæ°¸ç¶šåŒ–ï¼‰
  memory:
    source: "memory/"
    sync_to: "MIZUKAGAMI/Supabase"
    retention: "æ°¸ç¶š"

# Bãƒ–ãƒ­ãƒƒã‚¯çµ±åˆï¼ˆå…­èºæ—‹ã‚¹ã‚­ãƒ£ãƒ³ï¼‰
spiral_scan:
  input: "capture/"
  tool: "tools/spiral_scan.py"
  output: "structure/"
  metadata:
    - "spiral_scores"    # å…­èºæ—‹ã‚¹ã‚³ã‚¢
    - "cause_profile"    # çœŸå› ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
    - "phase_position"   # ä½ç›¸

# å‘½åè¦å‰‡
naming:
  # Slugï¼ˆURLå®‰å…¨ãªè­˜åˆ¥å­ï¼‰
  slug_regex: "^[a-z0-9-]+$"
  slug_max_length: 100
  
  # æ—¥ä»˜å½¢å¼
  date_regex: "^20\\d{2}-\\d{2}-\\d{2}$"
  date_format: "YYYY-MM-DD"

# ä¾‹å¤–ï¼ˆæ—¢å­˜æ§‹é€ ã¯ãƒ«ãƒ¼ãƒ«é©ç”¨å¤–ï¼‰
exceptions:
  # æ­´å²çš„è¨˜éŒ²ã¨ã—ã¦ä¿å­˜
  - "00_CORE/**"
  - "10_CAPTURE_MIZUKAGAMI/**"
  - "20_CRYSTALLIZATION_KOKUYOU/**"
  - "30_MEMORY_SHINSEN/**"
  - "ğŸ“¤Round3_å…¨AIé€ä»˜ç”¨/**"
  - "ğŸ“ŠREPORTS/**"
  
  # ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚¡ã‚¤ãƒ«
  - ".github/**"
  - ".vscode/**"
  - "node_modules/**"
  - "_inbox/README.md"

# Janitorå‹•ä½œè¨­å®šï¼ˆå‚ç…§ç”¨ã€å®Ÿéš›ã®è¨­å®šã¯janitor.config.ymlï¼‰
janitor:
  # å‡¦ç†å¯¾è±¡
  watch_paths:
    - "_inbox/**/*.md"
  
  # ç„¡è¦–ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«
  ignore_patterns:
    - "_inbox/README.md"
    - "_inbox/.gitkeep"
    - "_inbox/.DS_Store"

# ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
validation:
  # å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  required_fields:
    - "kind"
    - "lang"
    - "date"
    - "title"
    - "author"
    - "status"
  
  # è¨±å¯ã•ã‚Œã‚‹å€¤
  allowed_values:
    kind:
      - "story"
      - "spec"
      - "decision"
      - "log"        # NEW
      - "summary"
      - "letter"
      - "doc"
    
    lang:
      - "ja"
      - "en"
    
    author:
      - "GPT5"
      - "Claude"
      - "Gemini"
      - "Grok"
      - "DeepSeek"
      - "Cursor"
      - "CEO"
    
    status:
      - "draft"
      - "review"
      - "final"

# é‹ç”¨æˆ’å¾‹ï¼ˆæŠœç²‹ï¼‰
operations:
  rules:
    - "æ–°è¦ã¯å…¨éƒ¨ _inbox/ï¼ˆè¿·ã£ãŸã‚‰ç½®ãã€è€ƒãˆãšç½®ãï¼‰"
    - "frontmatterå¿…é ˆï¼ˆRouteå¯èƒ½æ€§ï¼å“²å­¦ã®ã‚¿ã‚°åŒ–ï¼‰"
    - "Janitorè­¦å‘Šã¯å‘³æ–¹ï¼ˆæ€’ã‚‰ãªã„ãƒ»ç›´ã™ãƒ»é€²ã‚€ï¼‰"
    - "status=final ã®ã¿ memory ã¸ï¼ˆå¯é€†æ€§ã‚’æ‹…ä¿ï¼‰"

# ä½¿ç”¨ä¾‹ï¼ˆæ‹¡å¼µç‰ˆï¼‰
examples:
  - input:
      kind: "log"
      lang: "ja"
      date: "2025-10-28"
      title: "Phase 1-Bå®Ÿè£…è¨˜éŒ²"
    output: "capture/2025-10-28_phase-1-b-implementation.md"
    next_step: "GPT-5æ§‹é€ åŒ– â†’ structure/"
  
  - input:
      kind: "decision"
      date: "2025-10-28"
      title: "Knowledge Relay v1.0"
    output: "decisions/2025-10-28_knowledge-relay-v1-0.md"
  
  - input:
      kind: "spec"
      title: "Spiral Scan Tool Specification"
    output: "specs/spiral-scan-tool-specification.md"

# å¤‰æ›´å±¥æ­´
changelog:
  - version: "1.2"
    date: "2025-10-28"
    author: "GPT5 + Cursor"
    changes:
      - "Knowledge Relayçµ±åˆ"
      - "Bãƒ–ãƒ­ãƒƒã‚¯ï¼ˆå…­èºæ—‹ã‚¹ã‚­ãƒ£ãƒ³ï¼‰è¿½åŠ "
      - "capture/structure/insight/memory/ ãƒ•ãƒ­ãƒ¼å®šç¾©"
      - "kind: log è¿½åŠ "
      - "é‹ç”¨æˆ’å¾‹ã®æ˜æ–‡åŒ–"
  
  - version: "1.1"
    date: "2025-10-27"
    author: "GPT5 + Cursor"
    changes:
      - "åˆç‰ˆä½œæˆ"
      - "7ç¨®é¡ã®kindã‚’å®šç¾©"

# é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
related:
  - "decisions/DEC_2025-10-27_FS-GUARDRAILS_v1.md"
  - "configs/janitor.config.yml"
  - "_inbox/README.md"
  - "tools/README.md"  # NEW
