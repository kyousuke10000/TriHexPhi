# TriHexÎ¦ Janitor Configuration v1.0
#
# Janitorï¼ˆç®¡ç†äººï¼‰ã¯ã€_inbox/ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•ã§æ•´ç†ã—ã¾ã™ã€‚
#
# æ›´æ–°æ—¥: 2025-10-27
# æ‰¿èª: GPT-5ï¼ˆçµ±æ²»å°†è»ï¼‰

version: 1.0

# å‹•ä½œãƒ¢ãƒ¼ãƒ‰
mode: auto  # gentle | auto | strict

# ãƒ¢ãƒ¼ãƒ‰å®šç¾©
modes:
  # Gentleãƒ¢ãƒ¼ãƒ‰ï¼ˆå„ªã—ãèª˜å°ï¼‰
  gentle:
    description: "è­¦å‘Šã®ã¿ï¼ˆè‡ªå‹•ç§»å‹•ã—ãªã„ï¼‰"
    enabled: true
    actions:
      - type: "warn_pr_comment"
        message: |
          âš ï¸  ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ _inbox/ ã«ã‚ã‚Šã¾ã™ãŒã€ã¾ã ç§»å‹•ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
          
          Frontmatterã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š
          - kind, lang, date, title ãŒå¿…é ˆã§ã™
          
          å‚è€ƒ: _inbox/README.md
      
      - type: "add_label"
        label: "needs-routing"
    
    auto_move: false
    block_pr: false
  
  # Autoãƒ¢ãƒ¼ãƒ‰ï¼ˆè‡ªå‹•æ•´å½¢ï¼‰- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
  auto:
    description: "è‡ªå‹•ç§»å‹•ï¼‹ã‚³ãƒŸãƒƒãƒˆå ±å‘Š"
    enabled: true
    actions:
      - type: "auto_move"
        on_success:
          - type: "commit_with_message"
            message: "chore(janitor): route inbox files per trihex.routes.yml"
          
          - type: "pr_comment"
            message: |
              âœ… JanitorãŒè‡ªå‹•ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç§»å‹•ã—ã¾ã—ãŸï¼š
              
              {{moved_files}}
              
              å‚è€ƒ: configs/trihex.routes.yml
      
      - type: "add_label"
        label: "janitor-processed"
    
    auto_move: true
    block_pr: false
  
  # Strictãƒ¢ãƒ¼ãƒ‰ï¼ˆå³æ ¼ï¼‰
  strict:
    description: "ãƒ«ãƒ¼ãƒ«é•åã§PRãƒ–ãƒ­ãƒƒã‚¯"
    enabled: true
    actions:
      - type: "auto_move"
      
      - type: "validate_rules"
        on_violation:
          - type: "block_pr"
            message: |
              ğŸš« ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ãƒ«ãƒ¼ãƒ«é•åãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚
              
              {{violations}}
              
              ä¿®æ­£ã—ã¦ã‹ã‚‰å†åº¦ãƒ—ãƒƒã‚·ãƒ¥ã—ã¦ãã ã•ã„ã€‚
          
          - type: "add_label"
            label: "rule-violation"
    
    auto_move: true
    block_pr: true

# ç›£è¦–è¨­å®š
watch:
  # ç›£è¦–å¯¾è±¡ãƒ‘ã‚¹
  paths:
    - "_inbox/**/*.md"
  
  # ç„¡è¦–ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«
  ignore:
    - "_inbox/README.md"
    - "_inbox/.gitkeep"
    - "_inbox/.DS_Store"
  
  # å‡¦ç†ãƒˆãƒªã‚¬ãƒ¼
  triggers:
    - event: "push"
      branches:
        - "main"
        - "feature/**"
    
    - event: "pull_request"
      actions:
        - "opened"
        - "synchronize"

# ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š
routing:
  # ãƒ«ãƒ¼ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«
  rules_file: "configs/trihex.routes.yml"
  
  # Slugç”Ÿæˆãƒ«ãƒ¼ãƒ«
  slug_generation:
    # ã‚¿ã‚¤ãƒˆãƒ« â†’ slugå¤‰æ›
    transforms:
      - type: "lowercase"
      - type: "replace_non_alphanumeric"
        replace_with: "-"
      - type: "collapse_consecutive"
        character: "-"
      - type: "trim"
        characters: "-"
    
    # æœ€å¤§é•·
    max_length: 100
    
    # è¡çªæ™‚ã®å¯¾å¿œ
    on_conflict: "append_counter"  # ã¾ãŸã¯ "error"
  
  # ãƒ•ã‚¡ã‚¤ãƒ«åç”Ÿæˆ
  filename_template: "{date}_{slug}.md"

# Gitè¨­å®š
git:
  # ã‚³ãƒŸãƒƒã‚¿ãƒ¼æƒ…å ±
  committer:
    name: "trihex-janitor[bot]"
    email: "actions@users.noreply.github.com"
  
  # ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  commit_message:
    template: "chore(janitor): route inbox files per trihex.routes.yml"
    
    # è©³ç´°æƒ…å ±ã‚’è¿½åŠ 
    include_details: true
    details_format: |
      
      Moved files:
      {{#each moved_files}}
      - {{this.from}} â†’ {{this.to}}
      {{/each}}
  
  # ãƒ–ãƒ©ãƒ³ãƒè¨­å®š
  branch:
    # ç›´æ¥pushã™ã‚‹ã‹ã€PRã‚’ä½œã‚‹ã‹
    strategy: "direct_push"  # ã¾ãŸã¯ "create_pr"
    
    # PRä½œæˆæ™‚ã®è¨­å®šï¼ˆstrategy: "create_pr"ã®å ´åˆï¼‰
    pr:
      branch_prefix: "janitor/"
      title: "ğŸ¤– Janitor: Route inbox files"
      body: |
        JanitorãŒ _inbox/ ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•ã§ç§»å‹•ã—ã¾ã—ãŸã€‚
        
        ## ç§»å‹•ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«
        {{moved_files}}
        
        ## ç¢ºèªäº‹é …
        - [ ] ç§»å‹•å…ˆãŒæ­£ã—ã„ã‹
        - [ ] FrontmatterãŒæ­£ã—ã„ã‹
        
        å‚è€ƒ: configs/trihex.routes.yml
      
      labels:
        - "janitor"
        - "automated"

# ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
validation:
  # Frontmatterãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  frontmatter:
    # å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
    required:
      - "kind"
      - "lang"
      - "date"
      - "title"
      - "author"
      - "status"
      - "visibility"
    
    # å‹ãƒã‚§ãƒƒã‚¯
    types:
      kind: "string"
      lang: "string"
      date: "string"
      title: "string"
      author: "string"
      status: "string"
      tier: "integer"
      relates_to: "array"
      visibility: "string"
      redactions: "array"
    
    # å€¤ã®æ¤œè¨¼ï¼ˆroutes.ymlã®allowed_valuesã‚’å‚ç…§ï¼‰
    validate_values: true
  
  # æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¤œè¨¼
  date_format: "YYYY-MM-DD"
  
  # ã‚¨ãƒ©ãƒ¼æ™‚ã®å‹•ä½œ
  on_error:
    mode: "warn"  # ã¾ãŸã¯ "fail"
    create_issue: false

# é€šçŸ¥è¨­å®š
notifications:
  # PR ã‚³ãƒ¡ãƒ³ãƒˆ
  pr_comment:
    enabled: true
    on_success: true
    on_failure: true
  
  # ãƒ©ãƒ™ãƒ«
  labels:
    enabled: true
    on_success: "janitor-processed"
    on_failure: "needs-frontmatter"
  
  # Issueä½œæˆï¼ˆã‚¨ãƒ©ãƒ¼æ™‚ï¼‰
  create_issue:
    enabled: false
    title: "Janitorã‚¨ãƒ©ãƒ¼: {{date}}"
    labels:
      - "janitor"
      - "error"

# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®š
performance:
  # ä¸€åº¦ã«å‡¦ç†ã™ã‚‹æœ€å¤§ãƒ•ã‚¡ã‚¤ãƒ«æ•°
  max_files_per_run: 50
  
  # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆç§’ï¼‰
  timeout: 300
  
  # ãƒªãƒˆãƒ©ã‚¤è¨­å®š
  retry:
    max_attempts: 3
    delay: 1000  # ãƒŸãƒªç§’

# ãƒ­ã‚°è¨­å®š
logging:
  # ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«
  level: "info"  # debug | info | warn | error
  
  # ãƒ­ã‚°å‡ºåŠ›å…ˆ
  output: "console"  # ã¾ãŸã¯ "file"
  
  # è©³ç´°ãƒ­ã‚°
  verbose: false

# ãƒ¢ãƒ¼ãƒ‰ç§»è¡Œè¨ˆç”»ï¼ˆå‚è€ƒç”¨ï¼‰
migration_plan:
  week_1:
    mode: "gentle"
    description: "å„ªã—ãèª˜å°ã€æ…£ã‚Œã‚‹æœŸé–“"
  
  week_2_3:
    mode: "auto"
    description: "è‡ªå‹•æ•´å½¢ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé‹ç”¨"
  
  week_4_onwards:
    mode: "strict"
    description: "å³æ ¼é‹ç”¨ã€å®Œå…¨ãªç§©åºç¶­æŒ"

# é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
related:
  - "configs/trihex.routes.yml"
  - "decisions/DEC_2025-10-27_FS-GUARDRAILS_v1.md"
  - "_inbox/README.md"

# å¤‰æ›´å±¥æ­´
changelog:
  - version: "1.0"
    date: "2025-10-27"
    author: "Cursor"
    changes:
      - "åˆç‰ˆä½œæˆ"
      - "3ãƒ¢ãƒ¼ãƒ‰ï¼ˆgentle/auto/strictï¼‰å®šç¾©"
      - "Gitè¨­å®šã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€é€šçŸ¥è¨­å®š"

