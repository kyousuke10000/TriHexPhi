{
  "name": "ğŸ¤– FAQ Answer Collector (Phase 3.5)",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 3 * * *"
            }
          ]
        }
      },
      "id": "c80ed7e2-33b8-4ed0-8887-085d86ebfd0d",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -2144,
        192
      ]
    },
    {
      "parameters": {
        "documentId": {
          "mode": "id",
          "value": "1SywiLtNP759TQ_dWnYq1XftGTJprZOL9kVx5dlLiH_0"
        },
        "sheetName": {
          "mode": "name",
          "value": "FAQ_Candidates"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "status",
              "lookupValue": "pending"
            }
          ]
        },
        "options": {}
      },
      "id": "acc4c3d5-9fd4-4e5f-a059-b66ee395f0de",
      "name": "Get Pending FAQs",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1936,
        192
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "YvL7P7HKwcuiK11r",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "98bdfe96-7e32-4aa5-a295-19dec0023be6",
      "name": "Split In Batches",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -1648,
        -128
      ]
    },
    {
      "parameters": {
        "url": "https://api.chatwork.com/v2/rooms/382546940/messages",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "force",
              "value": "1"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "neverError": true
            }
          }
        }
      },
      "id": "cd526cb9-b6f7-4f4c-9fc8-537e5a5265a3",
      "name": "Get Messages After Question",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1520,
        96
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "LnQfObJY55JQWAHf",
          "name": "ChatWork"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// å…¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–å¾—\nconst allMessages = $input.all().map(item => item.json);\n\n// è³ªå•ã®message_idï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã®æœ€åˆã®IDï¼‰\nlet questionMessageIds = $('Split In Batches').first().json.chatwork_message_id;\n\n// ç§‘å­¦çš„è¨˜æ³•ã‚’æ–‡å­—åˆ—ã«å¤‰æ›ï¼ˆBigIntå¯¾å¿œï¼‰\nif (typeof questionMessageIds === 'number') {\n  // ç§‘å­¦çš„è¨˜æ³•ã®å ´åˆã€BigIntã§å¤‰æ›\n  try {\n    questionMessageIds = BigInt(Math.round(questionMessageIds)).toString();\n  } catch (e) {\n    console.log('BigInt conversion failed, using String:', e);\n    questionMessageIds = String(questionMessageIds);\n  }\n} else {\n  questionMessageIds = String(questionMessageIds);\n}\n\nconst firstQuestionId = questionMessageIds.split(',')[0].trim();\n\nconsole.log(`Question message ID: ${firstQuestionId}`);\nconsole.log(`Type: ${typeof firstQuestionId}`);\n\n// è³ªå•ã‚ˆã‚Šå¾Œã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ•ã‚£ãƒ«ã‚¿\nconst laterMessages = allMessages.filter(msg => \n  parseInt(msg.message_id) > parseInt(firstQuestionId)\n);\n\nconsole.log(`Found ${laterMessages.length} messages after question`);\n\n// ãƒªãƒ—ãƒ©ã‚¤ãƒãƒ¼ã‚«ãƒ¼ã‚’æ¤œå‡º\n// [rp aid=é€ä¿¡è€…ID to=å—ä¿¡è€…ID-è¿”ä¿¡å…ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ID]\nconst replies = laterMessages.filter(msg => {\n  const body = msg.body || '';\n  // è³ªå•ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¸ã®ãƒªãƒ—ãƒ©ã‚¤ã‚’æ¤œå‡º\n  const replyPattern = new RegExp(`\\\\[rp aid=\\\\d+ to=\\\\d+-${firstQuestionId}\\\\]`);\n  const isReply = replyPattern.test(body);\n  \n  if (isReply) {\n    console.log(`Found reply: ${msg.message_id}`);\n    console.log(`Body preview: ${body.substring(0, 100)}`);\n  }\n  \n  return isReply;\n});\n\nconsole.log(`=== Reply Detection ===`);\nconsole.log(`Total replies found: ${replies.length}`);\n\n// ãƒªãƒ—ãƒ©ã‚¤ãŒ0ä»¶ã®å ´åˆã€ç©ºé…åˆ—ã‚’è¿”ã™\nif (replies.length === 0) {\n  console.log('No replies found. Skipping...');\n  return [];\n}\n\n// ãƒªãƒ—ãƒ©ã‚¤ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã™\nreturn replies.map(reply => ({ json: reply }));"
      },
      "id": "2e564c88-c0d3-4898-9657-9f4681c6fd95",
      "name": "Filter Reply Messages",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1360,
        96
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "reply-check",
              "leftValue": "={{ $json.message_id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "15ff9909-ac39-4d83-af88-197131c64886",
      "name": "Reply Found?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -1184,
        144
      ]
    },
    {
      "parameters": {
        "jsCode": "// å…¨ã¦ã®ãƒªãƒ—ãƒ©ã‚¤ã‚’å–å¾—\nconst allReplies = $input.all();\n\nif (allReplies.length === 0) {\n  console.log('No replies to process');\n  return [];\n}\n\nconsole.log(`Processing ${allReplies.length} replies`);\n\n// æœ€ã‚‚é•·ã„å›ç­”ã‚’é¸æŠï¼ˆè©³ã—ã„å›ç­”ã»ã©è‰¯ã„ã¨ä»®å®šï¼‰\nconst bestReply = allReplies.reduce((best, current) => {\n  const bestLength = (best.json.body || '').length;\n  const currentLength = (current.json.body || '').length;\n  return currentLength > bestLength ? current : best;\n});\n\n// ãƒªãƒ—ãƒ©ã‚¤ãƒãƒ¼ã‚«ãƒ¼ã‚’å‰Šé™¤ã—ã¦ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—\nconst rawBody = bestReply.json.body || '';\nconst cleanAnswer = rawBody\n  .replace(/\\[rp aid=\\d+ to=\\d+-\\d+\\]/g, '') // ãƒªãƒ—ãƒ©ã‚¤ãƒãƒ¼ã‚«ãƒ¼é™¤å»\n  .replace(/\\[To:[^\\]]+\\]/g, '') // To:ãƒãƒ¼ã‚«ãƒ¼é™¤å»\n  .trim();\n\nconsole.log(`=== Best Answer Selected ===`);\nconsole.log(`Message ID: ${bestReply.json.message_id}`);\nconsole.log(`Length: ${cleanAnswer.length} characters`);\nconsole.log(`Preview: ${cleanAnswer.substring(0, 100)}...`);\n\n// å…ƒã®FAQãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—\nconst faqData = $('Split In Batches').first().json;\n\nconsole.log(`Phase 3.4 Answer: ${faqData.answer.substring(0, 80)}...`);\n\nreturn [{\n  json: {\n    row_number: faqData.row_number,\n    timestamp: faqData.timestamp,\n    title: faqData.title,\n    question: faqData.question,\n    original_answer: faqData.answer, // â† Phase 3.4ã®æ¨¡ç¯„å›ç­”ã‚’ä¿å­˜\n    answer: cleanAnswer, // â† å®Ÿéš›ã®è¿”ä¿¡ï¼ˆä¼šè©±èª¿ï¼‰\n    category: faqData.category,\n    priority: faqData.priority,\n    frequency: faqData.frequency,\n    chatwork_message_id: faqData.chatwork_message_id,\n    status: 'replied'\n  }\n}];"
      },
      "id": "c9162437-aa12-4a0a-a718-abfea11d3ce7",
      "name": "Extract Best Answer",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -944,
        96
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "mode": "id",
          "value": "1SywiLtNP759TQ_dWnYq1XftGTJprZOL9kVx5dlLiH_0"
        },
        "sheetName": {
          "mode": "name",
          "value": "FAQ_Candidates"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [
            "title"
          ],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "title",
              "displayName": "title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "question",
              "displayName": "question",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "answer",
              "displayName": "answer",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "category",
              "displayName": "category",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "priority",
              "displayName": "priority",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "frequency",
              "displayName": "frequency",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "chatwork_message_id",
              "displayName": "chatwork_message_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "rowNumber",
              "displayName": "rowNumber",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "d50f58cc-2d49-4752-93f8-e16b7e531c68",
      "name": "Update FAQ Answer",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -224,
        -144
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "YvL7P7HKwcuiK11r",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "d0735ae9-3a95-4cab-afea-4265d0f5c091",
      "name": "Aggregate Results",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -752,
        240
      ]
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "messages": {
          "values": [
            {
              "content": "# å½¹å‰²\nãƒãƒ£ãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ã®å®Ÿéš›ã®ä¼šè©±èª¿ã®è¿”ä¿¡ã‚’ã€FAQè¨˜äº‹ã¨ã—ã¦å†æ§‹ç¯‰ã™ã‚‹ã€‚\n\n# é‡è¦åŸå‰‡\n1. **äº‹å®Ÿã®æŠ½å‡º**\n   - å®Ÿéš›ã®è¿”ä¿¡ã‹ã‚‰å…·ä½“çš„ãªäº‹å®Ÿãƒ»æ‰‹é †ãƒ»æƒ…å ±ã‚’æŠ½å‡º\n   - ä¼šè©±èª¿ã®è¡¨ç¾ã‚’èª¬æ˜èª¿ã«å¤‰æ›\n   - çµµæ–‡å­—ã‚„è¨˜å·ã‚’å‰Šé™¤\n\n2. **å…·ä½“æ€§ã®ç¶­æŒ**\n   - Phase 3.4ã§æ¨æ¸¬ã•ã‚ŒãŸå…·ä½“çš„ãªæƒ…å ±ã‚’æ´»ç”¨\n   - æ‰‹é †ã€ãƒªãƒ³ã‚¯ã€æœŸé™ã€å ´æ‰€ãªã©ã‚’æ˜ç¢ºã«\n   - ã€Œã€œã—ã¦ãã ã•ã„ã€ã¨ã„ã†æ˜ç¢ºãªæŒ‡ç¤ºå½¢å¼\n\n3. **æƒ…å ±ã®çµ±åˆ**\n   - å®Ÿéš›ã®è¿”ä¿¡ã«ã‚ã‚‹äº‹å®Ÿã‚’æœ€å„ªå…ˆ\n   - Phase 3.4ã®æ¨æ¸¬ã¯è£œå®Œçš„ã«ä½¿ç”¨\n   - çŸ›ç›¾ã™ã‚‹å ´åˆã¯å®Ÿéš›ã®è¿”ä¿¡ã‚’å„ªå…ˆ\n\n4. **å“è³ªåŸºæº–**\n   - 150-300æ–‡å­—\n   - å…·ä½“çš„ã§å®Ÿè·µå¯èƒ½\n   - åˆå¿ƒè€…ã«ã‚‚åˆ†ã‹ã‚Šã‚„ã™ã„\n\n# å¤‰æ›ã®ä¾‹\n\n## ä¾‹1ï¼šå°‚é–€ç”¨èªã®ã‚µãƒãƒ¼ãƒˆ\nã€å®Ÿéš›ã®è¿”ä¿¡ã€‘\nã€Œã‚ã‹ã‚‰ãªã„å˜èªãŒã‚ã£ãŸã‚‰ãƒãƒ£ãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§èã„ã¦ã­ï¼ã‚»ãƒƒã‚·ãƒ§ãƒ³å¾Œã§ã‚‚OKã§ã™ã€œã€\n\nã€Phase 3.4ã®æ¨æ¸¬ã€‘\nã€Œå°‚é–€ç”¨èªé›†ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ãƒãƒ£ãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§è³ªå•ã§ãã¾ã™ã€‚ã€\n\nã€FAQå›ç­”ï¼ˆçµ±åˆå¾Œï¼‰ã€‘\nã€Œã‚ã‹ã‚‰ãªã„å˜èªã‚„ãƒ•ãƒ¬ãƒ¼ã‚ºãŒã‚ã‚‹å ´åˆã¯ã€ãƒãƒ£ãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§è³ªå•ã—ã¦ãã ã•ã„ã€‚å„ã‚»ãƒƒã‚·ãƒ§ãƒ³å¾Œã®ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—ã§ã‚‚å¯¾å¿œå¯èƒ½ã§ã™ã€‚ã¾ãŸã€äº‹å‰ã«å°‚é–€ç”¨èªé›†ã‚’ç¢ºèªã—ã¦ãŠãã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚ã€\n\n## ä¾‹2ï¼šèª²é¡Œã®æå‡ºæ–¹æ³•\nã€å®Ÿéš›ã®è¿”ä¿¡ã€‘\nã€ŒWeek1ã®æŠ•ç¨¿ã¯ãƒãƒ£ãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ãŠé¡˜ã„ã—ã¾ã™ã€œç· åˆ‡ã¯æ—¥æ›œæ—¥ã®23:59ã§ã™ã‚ˆã€\n\nã€Phase 3.4ã®æ¨æ¸¬ã€‘\nã€ŒWeek1ã®èª²é¡Œã‚’ãƒãƒ£ãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚ã€\n\nã€FAQå›ç­”ï¼ˆçµ±åˆå¾Œï¼‰ã€‘\nã€ŒWeek1ã®èª²é¡Œã¯ã€ãƒãƒ£ãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚æå‡ºæœŸé™ã¯æ—¥æ›œæ—¥ã®23:59ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰ã§ã™ã€‚ã€\n\n## ä¾‹3ï¼šè³‡æ–™ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹\nã€å®Ÿéš›ã®è¿”ä¿¡ã€‘\nã€Œè³‡æ–™ã¯Notionã«ã‚ã‚Šã¾ã™ï¼ãƒã‚¤ãƒšãƒ¼ã‚¸ã‹ã‚‰ãƒªãƒ³ã‚¯é£›ã¹ã¾ã™ã‚ˆãƒ¼ã€\n\nã€Phase 3.4ã®æ¨æ¸¬ã€‘\nã€Œè³‡æ–™ã¯Notionã§ç¢ºèªã§ãã¾ã™ã€‚ã€\n\nã€FAQå›ç­”ï¼ˆçµ±åˆå¾Œï¼‰ã€‘\nã€Œè³‡æ–™ã¯Notionã§ç¢ºèªã§ãã¾ã™ã€‚ãƒã‚¤ãƒšãƒ¼ã‚¸ã‹ã‚‰Notionã¸ã®ãƒªãƒ³ã‚¯ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚ã€\n\n## ä¾‹4ï¼šã‚¤ãƒ™ãƒ³ãƒˆå‚åŠ æ–¹æ³•\nã€å®Ÿéš›ã®è¿”ä¿¡ã€‘\nã€ŒZoomãƒªãƒ³ã‚¯ã¯å‰æ—¥ã«ãƒ¡ãƒ¼ãƒ«ã§é€ã‚Šã¾ã™ï¼å½“æ—¥ã¯10åˆ†å‰ã‹ã‚‰å…¥å®¤OKã§ã™ã€\n\nã€Phase 3.4ã®æ¨æ¸¬ã€‘\nã€Œã‚¤ãƒ™ãƒ³ãƒˆå‚åŠ æ–¹æ³•ã¯ãƒ¡ãƒ¼ãƒ«ã§æ¡ˆå†…ã•ã‚Œã¾ã™ã€‚ã€\n\nã€FAQå›ç­”ï¼ˆçµ±åˆå¾Œï¼‰ã€‘\nã€Œã‚¤ãƒ™ãƒ³ãƒˆã®Zoomãƒªãƒ³ã‚¯ã¯å‰æ—¥ã«ãƒ¡ãƒ¼ãƒ«ã§é€ä»˜ã•ã‚Œã¾ã™ã€‚å½“æ—¥ã¯é–‹å§‹10åˆ†å‰ã‹ã‚‰å…¥å®¤å¯èƒ½ã§ã™ã€‚ã€\n\n# å‡ºåŠ›å½¢å¼\næ•´å½¢å¾Œã®FAQå›ç­”ã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚\nJSONã‚„ä½™è¨ˆãªèª¬æ˜ã¯ä¸è¦ã§ã™ã€‚",
              "role": "system"
            },
            {
              "content": "=ã€è³ªå•ã€‘\n{{ $('Extract Best Answer').item.json.question }}\n\nã€Phase 3.4ã§ç”Ÿæˆã•ã‚ŒãŸæ¨¡ç¯„å›ç­”ã€‘\n{{ $('Extract Best Answer').item.json.original_answer }}\n\nã€å®Ÿéš›ã®ãƒãƒ£ãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¿”ä¿¡ã€‘\n{{ $('Extract Best Answer').item.json.answer }}\n\nä¸Šè¨˜ã®æƒ…å ±ã‚’çµ±åˆã—ã¦ã€æœ€ã‚‚å…·ä½“çš„ã§å®Ÿç”¨çš„ãªFAQå›ç­”ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚\n\nè¦ä»¶:\n- å®Ÿéš›ã®è¿”ä¿¡ã‹ã‚‰äº‹å®Ÿã‚’æŠ½å‡ºï¼ˆæœ€å„ªå…ˆï¼‰\n- Phase 3.4ã®å…·ä½“æ€§ã‚’ç¶­æŒ\n- ä¼šè©±èª¿â†’èª¬æ˜èª¿ã«å¤‰æ›\n- 150-300æ–‡å­—"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        -784,
        -144
      ],
      "id": "26e0b79e-1423-4cd9-af09-a05721d1a962",
      "name": "OpenAI Reformat Answer",
      "credentials": {
        "openAiApi": {
          "id": "J33Jkek1x9rhPZBW",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Extract Best Answerã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿\nconst faqData = $('Extract Best Answer').first().json;\n\n// OpenAI Reformat Answerã‹ã‚‰ã®æ•´å½¢æ¸ˆã¿å›ç­”\nconst reformattedAnswer = $input.first().json.message.content.trim();\n\nconsole.log('=== FAQ Update ===');\nconsole.log(`Question: ${faqData.question}`);\nconsole.log(`Original: ${faqData.answer.substring(0, 50)}...`);\nconsole.log(`Reformatted: ${reformattedAnswer}`);\n\nreturn [{\n  json: {\n    row_number: faqData.row_number,\n    timestamp: faqData.timestamp,\n    title: faqData.title,\n    question: faqData.question,\n    answer: reformattedAnswer, // â† æ•´å½¢æ¸ˆã¿å›ç­”ã‚’ä½¿ç”¨\n    category: faqData.category,\n    priority: faqData.priority,\n    frequency: faqData.frequency,\n    chatwork_message_id: faqData.chatwork_message_id,\n    status: 'completed'\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -432,
        -144
      ],
      "id": "161628be-9025-4de2-b4b1-04142205f7ee",
      "name": "Merge FAQ Data"
    }
  ],
  "pinData": {},
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Get Pending FAQs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Pending FAQs": {
      "main": [
        [
          {
            "node": "Split In Batches",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split In Batches": {
      "main": [
        [
          {
            "node": "Aggregate Results",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Messages After Question",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Messages After Question": {
      "main": [
        [
          {
            "node": "Filter Reply Messages",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Reply Messages": {
      "main": [
        [
          {
            "node": "Reply Found?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Reply Found?": {
      "main": [
        [
          {
            "node": "Extract Best Answer",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Split In Batches",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Best Answer": {
      "main": [
        [
          {
            "node": "OpenAI Reformat Answer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update FAQ Answer": {
      "main": [
        [
          {
            "node": "Split In Batches",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Reformat Answer": {
      "main": [
        [
          {
            "node": "Merge FAQ Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge FAQ Data": {
      "main": [
        [
          {
            "node": "Update FAQ Answer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "7b8dd161-754e-45bf-ba18-32222e79d0a2",
  "meta": {
    "instanceId": "bb6582f136488f8663186c75084ae9be2ac2ce1a6068064fd0778c5e05f7b8d2"
  },
  "id": "aVMBvj8j1ttDcvYh",
  "tags": []
}